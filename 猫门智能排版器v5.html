<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>çŒ«é—¨æ™ºèƒ½æ’ç‰ˆå™¨ Pro v5</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;600;700&display=swap');
    
    :root {
      --primary: #9b8b7d;
      --primary-light: #c4b5a5;
      --primary-dark: #7a6b5d;
      --bg: #f6f5f3;
      --card: #fff;
      --text: #333;
      --text-light: #666;
      --text-muted: #999;
      --border: #e8e6e3;
      --success: #27ae60;
      --warning: #f39c12;
      --radius: 12px;
      --shadow: 0 2px 8px rgba(0,0,0,0.06);
    }
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Noto Sans SC', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg);
      min-height: 100vh;
      color: var(--text);
      line-height: 1.6;
    }
    
    /* é¡¶éƒ¨å¯¼èˆª */
    .header {
      background: var(--card);
      border-bottom: 1px solid var(--border);
      padding: 12px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 16px;
      font-weight: 600;
    }
    
    .logo-icon {
      width: 32px;
      height: 32px;
      background: linear-gradient(135deg, var(--primary), var(--primary-light));
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
    }
    
    .header-actions {
      display: flex;
      gap: 8px;
    }
    
    /* æŒ‰é’®ç³»ç»Ÿ */
    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      font-family: inherit;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }
    
    .btn-sm { padding: 6px 12px; font-size: 12px; }
    .btn-lg { padding: 12px 24px; font-size: 14px; }
    
    .btn-secondary {
      background: #f0eeec;
      color: var(--text-light);
    }
    .btn-secondary:hover { background: #e5e3e0; }
    
    .btn-primary {
      background: var(--text);
      color: #fff;
    }
    .btn-primary:hover { background: #555; }
    
    .btn-accent {
      background: linear-gradient(135deg, var(--primary), var(--primary-light));
      color: #fff;
    }
    .btn-accent:hover { box-shadow: 0 4px 12px rgba(155,139,125,0.3); }
    
    .btn-outline {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text-light);
    }
    .btn-outline:hover { border-color: var(--primary); color: var(--primary); }
    
    .btn-success {
      background: var(--success);
      color: #fff;
    }
    .btn-success:hover { background: #219a52; }
    
    /* æ­¥éª¤å¯¼èˆª */
    .steps-nav {
      background: var(--card);
      border-bottom: 1px solid var(--border);
      padding: 0 20px;
      display: flex;
      overflow-x: auto;
    }
    
    .step-tab {
      padding: 14px 18px;
      font-size: 13px;
      font-weight: 500;
      color: var(--text-muted);
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 8px;
      white-space: nowrap;
    }
    
    .step-tab:hover { color: var(--text-light); }
    .step-tab.active { color: var(--text); border-bottom-color: var(--primary); }
    .step-tab.done { color: var(--success); }
    
    .step-num {
      width: 20px;
      height: 20px;
      background: #eee;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      font-weight: 600;
    }
    
    .step-tab.active .step-num { background: var(--primary); color: #fff; }
    .step-tab.done .step-num { background: var(--success); color: #fff; }
    
    /* ä¸»å®¹å™¨ */
    .main { max-width: 1400px; margin: 0 auto; padding: 20px; }
    
    .step-panel { display: none; }
    .step-panel.active { display: block; }
    
    /* å¡ç‰‡ */
    .card {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      margin-bottom: 16px;
    }
    
    .card-header {
      padding: 14px 18px;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .card-title {
      font-size: 14px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .card-body { padding: 18px; }
    
    /* æ¨¡å¼é€‰æ‹©å¡ç‰‡ */
    .mode-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }
    
    @media (max-width: 700px) {
      .mode-grid { grid-template-columns: 1fr; }
    }
    
    .mode-card {
      border: 2px solid var(--border);
      border-radius: var(--radius);
      padding: 18px;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
    }
    
    .mode-card:hover { border-color: var(--primary-light); }
    .mode-card.active { border-color: var(--primary); background: #faf9f7; }
    
    .mode-card.active::after {
      content: 'âœ“';
      position: absolute;
      top: 12px;
      right: 12px;
      width: 22px;
      height: 22px;
      background: var(--primary);
      color: #fff;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
    }
    
    .mode-icon {
      font-size: 28px;
      margin-bottom: 10px;
    }
    
    .mode-title {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 6px;
    }
    
    .mode-desc {
      font-size: 12px;
      color: var(--text-muted);
      line-height: 1.6;
    }
    
    .mode-tag {
      display: inline-block;
      padding: 2px 8px;
      background: #f0f0f0;
      border-radius: 4px;
      font-size: 10px;
      color: var(--text-light);
      margin-top: 8px;
    }
    
    /* é£æ ¼é€‰æ‹© */
    .style-section { margin-top: 20px; }
    
    .style-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 14px;
      flex-wrap: wrap;
    }
    
    .style-tab {
      padding: 8px 16px;
      background: #f5f5f5;
      border: none;
      border-radius: 20px;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s;
      font-family: inherit;
    }
    
    .style-tab:hover { background: #eee; }
    .style-tab.active { background: var(--primary); color: #fff; }
    
    .style-options {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 10px;
    }
    
    .style-option {
      padding: 12px;
      border: 2px solid var(--border);
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
    }
    
    .style-option:hover { border-color: var(--primary-light); }
    .style-option.active { border-color: var(--primary); background: #faf9f7; }
    
    .style-option-icon { font-size: 24px; margin-bottom: 6px; }
    .style-option-name { font-size: 13px; font-weight: 500; }
    .style-option-desc { font-size: 11px; color: var(--text-muted); margin-top: 4px; }
    
    /* è‡ªå®šä¹‰é£æ ¼è¾“å…¥ */
    .custom-style-input {
      width: 100%;
      min-height: 80px;
      padding: 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 13px;
      font-family: inherit;
      resize: vertical;
      margin-top: 10px;
    }
    
    .custom-style-input:focus { outline: none; border-color: var(--primary); }
    
    /* æ–‡æœ¬è¾“å…¥åŒº */
    .textarea-box {
      width: 100%;
      min-height: 200px;
      padding: 14px;
      border: 2px dashed var(--border);
      border-radius: 10px;
      font-size: 14px;
      line-height: 1.8;
      font-family: inherit;
      resize: vertical;
      transition: all 0.2s;
    }
    
    .textarea-box:focus { outline: none; border-color: var(--primary); border-style: solid; }
    
    .textarea-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 10px;
      font-size: 12px;
      color: var(--text-muted);
    }
    
    /* æç¤ºè¯æ˜¾ç¤º */
    .prompt-display {
      background: #1a1a2e;
      border-radius: 10px;
      padding: 16px;
      max-height: 400px;
      overflow-y: auto;
    }
    
    .prompt-display pre {
      color: #e0e0e0;
      font-family: 'Monaco', 'Menlo', monospace;
      font-size: 12px;
      line-height: 1.7;
      white-space: pre-wrap;
      word-break: break-word;
    }
    
    /* è·³è½¬æŒ‰é’®ç»„ */
    .jump-buttons {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 14px;
    }
    
    .btn-claude {
      background: linear-gradient(135deg, #d97706, #f59e0b);
      color: #fff;
    }
    
    .btn-gemini {
      background: linear-gradient(135deg, #4285f4, #34a853);
      color: #fff;
    }
    
    /* é…è‰²é€‰æ‹© */
    .color-bar {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 18px;
      border-top: 1px solid var(--border);
      flex-wrap: wrap;
    }
    
    .color-label { font-size: 13px; color: var(--text-light); }
    
    .color-options { display: flex; gap: 6px; }
    
    .color-btn {
      width: 28px;
      height: 28px;
      border-radius: 8px;
      border: 2px solid transparent;
      cursor: pointer;
      transition: all 0.15s;
    }
    
    .color-btn:hover { transform: scale(1.1); }
    .color-btn.active { border-color: var(--text); }
    
    /* ç¼–è¾‘å™¨å¸ƒå±€ */
    .editor-layout {
      display: grid;
      grid-template-columns: 1fr 360px;
      gap: 20px;
    }
    
    @media (max-width: 900px) {
      .editor-layout { grid-template-columns: 1fr; }
    }
    
    /* æ¨¡å—åˆ—è¡¨ */
    .blocks-list {
      max-height: 500px;
      overflow-y: auto;
      padding: 14px;
    }
    
    .block-item {
      background: #fafafa;
      border-radius: 10px;
      margin-bottom: 10px;
      border: 1px solid transparent;
      transition: all 0.2s;
    }
    
    .block-item:hover { border-color: #e0e0e0; }
    
    .block-head {
      padding: 8px 12px;
      background: #f5f5f5;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-radius: 10px 10px 0 0;
    }
    
    .block-type-sel {
      padding: 4px 8px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 11px;
      font-family: inherit;
      background: #fff;
    }
    
    .block-actions { display: flex; gap: 2px; }
    
    .block-act-btn {
      width: 24px;
      height: 24px;
      border: none;
      background: transparent;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
      color: #999;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.15s;
    }
    
    .block-act-btn:hover { background: #e8e8e8; color: #666; }
    .block-act-btn.del:hover { background: #fee; color: #e74c3c; }
    .block-act-btn.img:hover { background: #e8f5e9; color: #27ae60; }
    
    .block-body { padding: 10px; }
    
    .block-input {
      width: 100%;
      min-height: 40px;
      padding: 8px 10px;
      border: 1px solid #e8e8e8;
      border-radius: 6px;
      font-size: 13px;
      line-height: 1.6;
      font-family: inherit;
      resize: vertical;
    }
    
    .block-input:focus { outline: none; border-color: var(--primary); }
    
    /* å›¾ç‰‡æ¨¡å— */
    .img-block-preview {
      text-align: center;
      margin-bottom: 8px;
    }
    
    .img-block-preview img {
      max-width: 100%;
      max-height: 100px;
      border-radius: 6px;
    }
    
    .img-placeholder {
      background: #fffbeb;
      padding: 14px;
      border-radius: 8px;
      text-align: center;
    }
    
    .img-placeholder-text {
      color: #d97706;
      font-size: 13px;
      margin-bottom: 8px;
    }
    
    .img-prompt-box {
      background: #f5f5f5;
      border-radius: 6px;
      padding: 10px;
      margin-top: 10px;
      font-size: 11px;
    }
    
    .img-prompt-label {
      color: #666;
      margin-bottom: 6px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .img-prompt-text {
      color: #333;
      font-family: monospace;
      word-break: break-all;
    }
    
    .img-jump-btns {
      display: flex;
      gap: 4px;
      margin-top: 8px;
      flex-wrap: wrap;
    }
    
    .img-jump-btns .btn { padding: 4px 8px; font-size: 10px; }
    
    /* æ‰‹æœºé¢„è§ˆ */
    .phone-wrap {
      position: sticky;
      top: 100px;
    }
    
    .phone-frame {
      background: #1a1a1a;
      border-radius: 32px;
      padding: 10px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.12);
    }
    
    .phone-screen {
      background: #fff;
      border-radius: 24px;
      overflow: hidden;
    }
    
    .phone-top {
      padding: 8px 14px;
      background: #fff;
      border-bottom: 1px solid #f0f0f0;
      display: flex;
      justify-content: space-between;
      font-size: 11px;
      color: #999;
    }
    
    .phone-content {
      height: 420px;
      overflow-y: auto;
      padding: 16px;
    }
    
    .phone-bottom {
      padding: 10px 14px;
      background: #f8f8f8;
      display: flex;
      gap: 8px;
    }
    
    .phone-bottom .btn { flex: 1; }
    
    /* æ·»åŠ æ¨¡å— */
    .add-blocks {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      padding: 0 14px 14px;
    }
    
    .add-block-btn {
      padding: 6px 12px;
      border: 1px dashed #ddd;
      border-radius: 6px;
      background: transparent;
      color: #999;
      font-size: 12px;
      cursor: pointer;
      font-family: inherit;
      transition: all 0.15s;
    }
    
    .add-block-btn:hover {
      border-color: var(--primary);
      color: var(--primary);
      background: #faf9f7;
    }
    
    /* ç¬¬å››æ­¥ï¼šè¥é”€ç‰©æ–™ */
    .material-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 16px;
    }
    
    .material-card {
      border: 1px solid var(--border);
      border-radius: var(--radius);
      overflow: hidden;
    }
    
    .material-head {
      padding: 12px 14px;
      background: #fafafa;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .material-title {
      font-size: 13px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .material-content {
      padding: 14px;
      min-height: 100px;
      max-height: 200px;
      overflow-y: auto;
      font-size: 13px;
      line-height: 1.8;
      color: var(--text-light);
      white-space: pre-wrap;
    }
    
    .material-content.empty {
      color: #ccc;
      font-style: italic;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    /* æ¨¡æ€æ¡† */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.2s;
    }
    
    .modal-overlay.show { opacity: 1; visibility: visible; }
    
    .modal {
      background: #fff;
      border-radius: 14px;
      width: 90%;
      max-width: 600px;
      max-height: 85vh;
      overflow: hidden;
      transform: scale(0.95);
      transition: transform 0.2s;
    }
    
    .modal-overlay.show .modal { transform: scale(1); }
    
    .modal-head {
      padding: 16px 20px;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .modal-title { font-size: 15px; font-weight: 600; }
    
    .modal-close {
      width: 28px;
      height: 28px;
      border: none;
      background: #f5f5f5;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      color: #999;
    }
    
    .modal-close:hover { background: #eee; color: #666; }
    
    .modal-body { padding: 20px; max-height: 60vh; overflow-y: auto; }
    
    .modal-input {
      width: 100%;
      padding: 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 13px;
      font-family: inherit;
      margin-bottom: 12px;
    }
    
    .modal-textarea {
      width: 100%;
      min-height: 200px;
      padding: 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 13px;
      font-family: inherit;
      line-height: 1.7;
      resize: vertical;
    }
    
    .modal-input:focus, .modal-textarea:focus { outline: none; border-color: var(--primary); }
    
    .modal-divider {
      text-align: center;
      color: #999;
      font-size: 12px;
      margin: 16px 0;
      position: relative;
    }
    
    .modal-divider::before, .modal-divider::after {
      content: '';
      position: absolute;
      top: 50%;
      width: 40%;
      height: 1px;
      background: #eee;
    }
    
    .modal-divider::before { left: 0; }
    .modal-divider::after { right: 0; }
    
    .modal-upload {
      padding: 30px;
      border: 2px dashed #ddd;
      border-radius: 10px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .modal-upload:hover { border-color: var(--primary); background: #faf9f7; }
    
    .modal-foot {
      padding: 14px 20px;
      border-top: 1px solid var(--border);
      display: flex;
      justify-content: flex-end;
      gap: 8px;
    }
    
    /* Toast */
    .toast {
      position: fixed;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%) translateY(80px);
      background: #333;
      color: #fff;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 13px;
      opacity: 0;
      transition: all 0.3s;
      z-index: 1001;
    }
    
    .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
    
    /* å¯¼èˆªæŒ‰é’® */
    .nav-row {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
      padding-top: 16px;
      border-top: 1px solid var(--border);
    }
    
    /* è¾…åŠ© */
    .text-muted { color: var(--text-muted); }
    .text-sm { font-size: 12px; }
    .mt-2 { margin-top: 8px; }
    .mt-4 { margin-top: 16px; }
    .mb-2 { margin-bottom: 8px; }
    .mb-4 { margin-bottom: 16px; }
    .hidden { display: none !important; }
    
    .divider-preview { 
      text-align: center; 
      color: #ddd; 
      padding: 6px; 
      font-size: 12px; 
    }

    /* æç¤ºæ¡† */
    .tip-box {
      background: #f8f7f5;
      border-radius: 8px;
      padding: 14px;
      font-size: 13px;
      color: var(--text-light);
      margin-top: 14px;
    }
    
    .tip-box-title {
      font-weight: 600;
      color: var(--text);
      margin-bottom: 6px;
    }
    
    .tip-box ol, .tip-box ul {
      padding-left: 18px;
      line-height: 1.9;
    }
    
    .tip-box code {
      background: #fff;
      padding: 1px 5px;
      border-radius: 3px;
      font-size: 11px;
    }

    /* æˆåŠŸæç¤º */
    .success-banner {
      background: linear-gradient(135deg, #d4edda, #c3e6cb);
      border: 1px solid #28a745;
      border-radius: 10px;
      padding: 16px;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .success-banner-icon {
      font-size: 24px;
    }
    
    .success-banner-text {
      flex: 1;
    }
    
    .success-banner-title {
      font-weight: 600;
      color: #155724;
      margin-bottom: 4px;
    }
    
    .success-banner-desc {
      font-size: 13px;
      color: #155724;
    }
  </style>
</head>
<body>

<!-- é¡¶éƒ¨ -->
<header class="header">
  <div class="logo">
    <div class="logo-icon">ğŸ±</div>
    <span>çŒ«é—¨æ™ºèƒ½æ’ç‰ˆå™¨ Pro</span>
  </div>
  <div class="header-actions">
    <button class="btn btn-secondary btn-sm" onclick="resetAll()">é‡æ–°å¼€å§‹</button>
    <button class="btn btn-primary btn-sm" onclick="copyAllCode()">ğŸ“‹ å¤åˆ¶ä»£ç </button>
  </div>
</header>

<!-- æ­¥éª¤å¯¼èˆª -->
<nav class="steps-nav">
  <div class="step-tab active" data-step="1" onclick="goToStep(1)">
    <span class="step-num">1</span> é€‰æ‹©æ¨¡å¼
  </div>
  <div class="step-tab" data-step="2" onclick="goToStep(2)">
    <span class="step-num">2</span> ç”Ÿæˆæç¤ºè¯
  </div>
  <div class="step-tab" data-step="3" onclick="goToStep(3)">
    <span class="step-num">3</span> ç¼–è¾‘æ’ç‰ˆ
  </div>
  <div class="step-tab" data-step="4" onclick="goToStep(4)">
    <span class="step-num">4</span> è¥é”€ç‰©æ–™
  </div>
</nav>

<div class="main">

<!-- ========== æ­¥éª¤1: é€‰æ‹©æ¨¡å¼ ========== -->
<div class="step-panel active" data-step="1">
  <div class="card">
    <div class="card-header">
      <div class="card-title">ğŸ“Œ é€‰æ‹©ä½ çš„ä½¿ç”¨åœºæ™¯</div>
    </div>
    <div class="card-body">
      <div class="mode-grid">
        <div class="mode-card active" data-mode="A" onclick="selectMode('A')">
          <div class="mode-icon">ğŸ“</div>
          <div class="mode-title">æ¨¡å¼Aï¼šæ–‡ç« æ’ç‰ˆ</div>
          <div class="mode-desc">æ–‡ç« å·²ç»å†™å¥½ï¼Œéœ€è¦æ·»åŠ é‡‘å¥ã€åˆ†æ®µã€å¼ºè°ƒç­‰æ’ç‰ˆæ ¼å¼</div>
          <div class="mode-tag">æœ€å¸¸ç”¨</div>
        </div>
        <div class="mode-card" data-mode="B" onclick="selectMode('B')">
          <div class="mode-icon">âœ¨</div>
          <div class="mode-title">æ¨¡å¼Bï¼šä¸»é¢˜åˆ›ä½œ</div>
          <div class="mode-desc">åªæœ‰ä¸€ä¸ªä¸»é¢˜æˆ–æƒ³æ³•ï¼Œéœ€è¦AIç”Ÿæˆå®Œæ•´çš„çˆ†æ¬¾æ–‡ç« </div>
          <div class="mode-tag">é€‚åˆæ²¡ç´ ææ—¶</div>
        </div>
        <div class="mode-card" data-mode="C" onclick="selectMode('C')">
          <div class="mode-icon">ğŸ“š</div>
          <div class="mode-title">æ¨¡å¼Cï¼šé•¿ç¨¿æç‚¼</div>
          <div class="mode-desc">æœ‰è¯¾ç¨‹é€å­—ç¨¿ã€æ’­å®¢æ–‡å­—ç¨¿ç­‰é•¿ç´ æï¼Œéœ€è¦æç‚¼æˆç²¾åæ–‡ç« </div>
          <div class="mode-tag">é€‚åˆæœ‰åŸå§‹ç´ æ</div>
        </div>
        <div class="mode-card" data-mode="D" onclick="selectMode('D')">
          <div class="mode-icon">ğŸ§©</div>
          <div class="mode-title">æ¨¡å¼Dï¼šç´ ææ•´åˆ</div>
          <div class="mode-desc">æœ‰å¤šä¸ªç¢ç‰‡ç´ æï¼ˆåˆ«äººçš„æ–‡ç« ã€ç¬”è®°ã€æƒ³æ³•ç­‰ï¼‰ï¼Œéœ€è¦æ•´åˆæˆåŸåˆ›æ–‡ç« </div>
          <div class="mode-tag">é€‚åˆæ”¶é›†äº†å¾ˆå¤šç´ æ</div>
        </div>
      </div>
      
      <!-- é£æ ¼é€‰æ‹©ï¼ˆæ¨¡å¼B/C/Dæ˜¾ç¤ºï¼‰ -->
      <div class="style-section hidden" id="styleSection">
        <div class="card-title mb-2">ğŸ¨ é€‰æ‹©æ–‡ç« é£æ ¼</div>
        
        <div class="style-tabs">
          <button class="style-tab active" data-tab="preset" onclick="switchStyleTab('preset')">é¢„è®¾é£æ ¼</button>
          <button class="style-tab" data-tab="blogger" onclick="switchStyleTab('blogger')">åšä¸»é£æ ¼</button>
          <button class="style-tab" data-tab="custom" onclick="switchStyleTab('custom')">è‡ªå®šä¹‰</button>
        </div>
        
        <!-- é¢„è®¾é£æ ¼ -->
        <div class="style-panel" data-panel="preset">
          <div class="style-options">
            <div class="style-option active" data-style="catgate" onclick="selectStyle('catgate')">
              <div class="style-option-icon">ğŸ±</div>
              <div class="style-option-name">çŒ«é—¨é£æ ¼</div>
              <div class="style-option-desc">ä¸“ä¸šæœ‰æ·±åº¦ã€æ¸©æš–æœ‰æ´å¯Ÿ</div>
            </div>
            <div class="style-option" data-style="lemon" onclick="selectStyle('lemon')">
              <div class="style-option-icon">ğŸ‹</div>
              <div class="style-option-name">æŸ æª¬å¼</div>
              <div class="style-option-desc">è½»æ¾æ´»æ³¼ã€å¹´è½»åŒ–</div>
            </div>
            <div class="style-option" data-style="healing" onclick="selectStyle('healing')">
              <div class="style-option-icon">ğŸŒ¸</div>
              <div class="style-option-name">æ²»æ„ˆå¼</div>
              <div class="style-option-desc">æ¸©æš–å…±æƒ…ã€æƒ…æ„Ÿå‘</div>
            </div>
            <div class="style-option" data-style="hardcore" onclick="selectStyle('hardcore')">
              <div class="style-option-icon">ğŸ’</div>
              <div class="style-option-name">å¹²è´§å¼</div>
              <div class="style-option-desc">ç¡¬æ ¸ä¸“ä¸šã€æœ‰æ·±åº¦</div>
            </div>
            <div class="style-option" data-style="story" onclick="selectStyle('story')">
              <div class="style-option-icon">ğŸ“–</div>
              <div class="style-option-name">æ•…äº‹å¼</div>
              <div class="style-option-desc">æ¡ˆä¾‹é©±åŠ¨ã€å™äº‹æ„Ÿ</div>
            </div>
          </div>
        </div>
        
        <!-- åšä¸»é£æ ¼ -->
        <div class="style-panel hidden" data-panel="blogger">
          <div class="style-options">
            <div class="style-option" data-style="mimeng" onclick="selectStyle('mimeng')">
              <div class="style-option-icon">ğŸ”¥</div>
              <div class="style-option-name">å’ªè’™å¼</div>
              <div class="style-option-desc">æƒ…ç»ªå¼ åŠ›ã€é‡‘å¥å¯†é›†ã€è§‚ç‚¹çŠ€åˆ©</div>
            </div>
            <div class="style-option" data-style="kaizhi" onclick="selectStyle('kaizhi')">
              <div class="style-option-icon">ğŸ§ </div>
              <div class="style-option-name">å¼€æ™º/é˜³å¿—å¹³å¼</div>
              <div class="style-option-desc">è®¤çŸ¥ç§‘å­¦ã€ä¿¡æ¯å¯†åº¦é«˜ã€æœ‰å­¦æœ¯åº•è•´</div>
            </div>
            <div class="style-option" data-style="zhihu" onclick="selectStyle('zhihu')">
              <div class="style-option-icon">ğŸ’¡</div>
              <div class="style-option-name">çŸ¥ä¹å¤§Vå¼</div>
              <div class="style-option-desc">é€»è¾‘æ¸…æ™°ã€è®ºæ®å……åˆ†ã€ä¸“ä¸šå¯ä¿¡</div>
            </div>
            <div class="style-option" data-style="lifestyle" onclick="selectStyle('lifestyle')">
              <div class="style-option-icon">ğŸŒ¿</div>
              <div class="style-option-name">ç”Ÿæ´»æ–¹å¼å¼</div>
              <div class="style-option-desc">ç²¾è‡´ç¾å­¦ã€æœ‰å“å‘³ã€ä¸è¯´æ•™</div>
            </div>
          </div>
        </div>
        
        <!-- è‡ªå®šä¹‰ -->
        <div class="style-panel hidden" data-panel="custom">
          <p class="text-sm text-muted mb-2">æè¿°ä½ æƒ³è¦çš„é£æ ¼ï¼Œæˆ–ç²˜è´´ä¸€ç¯‡å‚è€ƒæ–‡ç« è®©AIå­¦ä¹ ï¼š</p>
          <textarea class="custom-style-input" id="customStyleInput" placeholder="ä¾‹å¦‚ï¼šåƒææ¾è”šè€å¸ˆé‚£æ ·ï¼Œç”¨å¿ƒç†å­¦è§†è§’åˆ†ææ—¥å¸¸é—®é¢˜ï¼Œè¯­è¨€å¹³å®ä½†æœ‰æ´å¯Ÿï¼Œè®©è¯»è€…æœ‰ã€ŒåŸæ¥å¦‚æ­¤ã€çš„æ„Ÿè§‰..."></textarea>
        </div>
      </div>
    </div>
  </div>
  
  <div class="nav-row">
    <div></div>
    <button class="btn btn-primary" onclick="goToStep(2)">ä¸‹ä¸€æ­¥ï¼šç”Ÿæˆæç¤ºè¯ â†’</button>
  </div>
</div>

<!-- ========== æ­¥éª¤2: ç”Ÿæˆæç¤ºè¯ ========== -->
<div class="step-panel" data-step="2">
  <div class="card">
    <div class="card-header">
      <div class="card-title">ğŸ“‹ å¤åˆ¶æç¤ºè¯</div>
      <button class="btn btn-primary btn-sm" onclick="copyPrompt()">ğŸ“‹ å¤åˆ¶</button>
    </div>
    <div class="card-body">
      <div class="prompt-display">
        <pre id="promptText"></pre>
      </div>
      
      <div class="tip-box">
        <div class="tip-box-title">ğŸ’¡ ä½¿ç”¨è¯´æ˜</div>
        <ol>
          <li>ç‚¹å‡»ä¸Šæ–¹ã€Œå¤åˆ¶ã€æŒ‰é’®</li>
          <li id="tipStep3">æ‰“å¼€AIï¼Œç²˜è´´æç¤ºè¯</li>
          <li>æŠŠAIè¿”å›çš„å†…å®¹å¤åˆ¶ï¼Œè¿›å…¥ä¸‹ä¸€æ­¥ç²˜è´´</li>
        </ol>
      </div>
      
      <div class="jump-buttons">
        <a href="https://claude.ai" target="_blank" class="btn btn-claude">Claude</a>
        <a href="https://gemini.google.com" target="_blank" class="btn btn-gemini">Gemini</a>
        <a href="https://chat.openai.com" target="_blank" class="btn btn-secondary">ChatGPT</a>
        <a href="https://kimi.moonshot.cn" target="_blank" class="btn btn-secondary">Kimi</a>
      </div>
    </div>
  </div>
  
  <div class="nav-row">
    <button class="btn btn-secondary" onclick="goToStep(1)">â† è¿”å›é€‰æ‹©</button>
    <button class="btn btn-primary" onclick="goToStep(3)">ä¸‹ä¸€æ­¥ï¼šç¼–è¾‘æ’ç‰ˆ â†’</button>
  </div>
</div>

<!-- ========== æ­¥éª¤3: ç¼–è¾‘æ’ç‰ˆ ========== -->
<div class="step-panel" data-step="3">
  <!-- è¾“å…¥åŒº -->
  <div class="card" id="inputCard">
    <div class="card-header">
      <div class="card-title">ğŸ“¥ ç²˜è´´AIè¿”å›çš„å†…å®¹</div>
    </div>
    <div class="card-body">
      <textarea class="textarea-box" id="inputText" placeholder="æŠŠAIç”Ÿæˆçš„æ–‡ç« å†…å®¹ç²˜è´´åˆ°è¿™é‡Œ...

æ”¯æŒçš„æ ¼å¼ï¼š
> é‡‘å¥å†…å®¹
**å¼ºè°ƒå†…å®¹**
## æ ‡é¢˜
---
- åˆ—è¡¨é¡¹
![å›¾ç‰‡](å»ºè®®ï¼šæè¿°)" oninput="updateWordCount()"></textarea>
      <div class="textarea-footer">
        <span id="wordCount">0 å­—</span>
        <button class="btn btn-accent" onclick="parseContent()">ğŸš€ æ™ºèƒ½è§£æ</button>
      </div>
    </div>
  </div>
  
  <!-- ç¼–è¾‘å™¨ -->
  <div class="editor-layout" id="editorSection" style="display: none;">
    <div>
      <div class="card">
        <div class="card-header">
          <div class="card-title">ğŸ“ å†…å®¹æ¨¡å— <span id="blockCount">(0)</span></div>
          <button class="btn btn-sm btn-outline" onclick="showInputCard()">é‡æ–°ç²˜è´´</button>
        </div>
        <div class="blocks-list" id="blocksList"></div>
        <div class="add-blocks">
          <button class="add-block-btn" onclick="addBlock('paragraph')">+ æ®µè½</button>
          <button class="add-block-btn" onclick="addBlock('quote')">+ é‡‘å¥</button>
          <button class="add-block-btn" onclick="addBlock('heading')">+ æ ‡é¢˜</button>
          <button class="add-block-btn" onclick="addBlock('divider')">+ åˆ†å‰²çº¿</button>
          <button class="add-block-btn" onclick="addBlock('list')">+ åˆ—è¡¨</button>
          <button class="add-block-btn" onclick="addBlock('imagePlaceholder')">+ å›¾ç‰‡</button>
        </div>
        <div class="color-bar">
          <span class="color-label">é…è‰²ï¼š</span>
          <div class="color-options">
            <button class="color-btn active" data-scheme="morandi" style="background: linear-gradient(135deg, #9b8b7d, #c4b5a5);" title="è«å…°è¿ª"></button>
            <button class="color-btn" data-scheme="green" style="background: linear-gradient(135deg, #5d8a66, #7eb085);" title="æ£®ç»¿"></button>
            <button class="color-btn" data-scheme="purple" style="background: linear-gradient(135deg, #8b7eb8, #a99cd1);" title="è–°è¡£è‰"></button>
            <button class="color-btn" data-scheme="milktea" style="background: linear-gradient(135deg, #a67c52, #c9a77c);" title="å¥¶èŒ¶"></button>
            <button class="color-btn" data-scheme="blackgold" style="background: linear-gradient(135deg, #333, #c9a962);" title="é»‘é‡‘"></button>
            <button class="color-btn" data-scheme="coral" style="background: linear-gradient(135deg, #e07a5f, #f2a07b);" title="çŠç‘š"></button>
          </div>
        </div>
      </div>
    </div>
    
    <div class="phone-wrap">
      <div class="phone-frame">
        <div class="phone-screen">
          <div class="phone-top">
            <span>é¢„è§ˆæ•ˆæœ</span>
            <span>çŒ«é—¨</span>
          </div>
          <div class="phone-content" id="previewContent">
            <div class="text-center text-muted" style="padding: 40px;">é¢„è§ˆå†…å®¹</div>
          </div>
          <div class="phone-bottom">
            <button class="btn btn-secondary btn-sm" onclick="copyAllCode()">å¤åˆ¶ä»£ç </button>
            <button class="btn btn-primary btn-sm" onclick="goToStep(4)">è¥é”€ç‰©æ–™</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="nav-row">
    <button class="btn btn-secondary" onclick="goToStep(2)">â† è¿”å›æç¤ºè¯</button>
    <button class="btn btn-primary" onclick="goToStep(4)">ä¸‹ä¸€æ­¥ï¼šè¥é”€ç‰©æ–™ â†’</button>
  </div>
</div>

<!-- ========== æ­¥éª¤4: è¥é”€ç‰©æ–™ ========== -->
<div class="step-panel" data-step="4">
  <!-- ç”Ÿæˆæç¤ºè¯ -->
  <div class="card">
    <div class="card-header">
      <div class="card-title">ğŸ¯ ç”Ÿæˆè¥é”€ç‰©æ–™</div>
    </div>
    <div class="card-body">
      <p class="text-muted mb-4">æ ¹æ®ä½ çš„æ–‡ç« å†…å®¹ï¼Œä¸€é”®ç”Ÿæˆå…¨å¥—è¥é”€ç‰©æ–™çš„æç¤ºè¯</p>
      <button class="btn btn-accent btn-lg" onclick="generateMaterials()">âœ¨ ç”Ÿæˆæç¤ºè¯</button>
    </div>
  </div>
  
  <!-- æç¤ºè¯æ˜¾ç¤º -->
  <div class="card" id="materialPromptCard" style="display: none;">
    <div class="card-header">
      <div class="card-title">ğŸ“‹ è¥é”€ç‰©æ–™æç¤ºè¯</div>
      <button class="btn btn-primary btn-sm" onclick="copyMaterialPrompt()">ğŸ“‹ å¤åˆ¶</button>
    </div>
    <div class="card-body">
      <div class="prompt-display" style="max-height: 200px;">
        <pre id="materialPromptText"></pre>
      </div>
      <div class="jump-buttons">
        <a href="https://claude.ai" target="_blank" class="btn btn-claude">å‘ç»™Claude</a>
        <a href="https://gemini.google.com" target="_blank" class="btn btn-gemini">å‘ç»™Gemini</a>
      </div>
    </div>
  </div>
  
  <!-- ç²˜è´´AIè¿”å›å†…å®¹ -->
  <div class="card" id="materialInputCard" style="display: none;">
    <div class="card-header">
      <div class="card-title">ğŸ“¥ ç²˜è´´AIè¿”å›çš„ç‰©æ–™</div>
    </div>
    <div class="card-body">
      <textarea class="textarea-box" id="materialInputText" placeholder="æŠŠAIç”Ÿæˆçš„è¥é”€ç‰©æ–™ç²˜è´´åˆ°è¿™é‡Œï¼Œä¼šè‡ªåŠ¨åˆ†å‘åˆ°ä¸‹æ–¹å„ä¸ªå¡ç‰‡ä¸­..." style="min-height: 150px;"></textarea>
      <div style="margin-top: 12px; display: flex; gap: 8px;">
        <button class="btn btn-accent" onclick="parseMaterials()">ğŸš€ æ™ºèƒ½è§£æ</button>
        <button class="btn btn-secondary" onclick="clearMaterials()">æ¸…ç©º</button>
      </div>
    </div>
  </div>
  
  <!-- ç‰©æ–™å¡ç‰‡ -->
  <div class="material-grid" id="materialGrid" style="display: none;">
    <!-- åŠ¨æ€ç”Ÿæˆ -->
  </div>
  
  <!-- æ“ä½œæŒ‰é’® -->
  <div class="card" id="materialActionsCard" style="display: none;">
    <div class="card-body" style="display: flex; gap: 12px; justify-content: center;">
      <button class="btn btn-primary" onclick="copyAllMaterials()">ğŸ“‹ å¤åˆ¶æ‰€æœ‰ç‰©æ–™</button>
      <button class="btn btn-secondary" onclick="exportMaterials()">ğŸ’¾ å¯¼å‡ºä¸ºæ–‡æœ¬</button>
    </div>
  </div>
  
  <div class="nav-row">
    <button class="btn btn-secondary" onclick="goToStep(3)">â† è¿”å›ç¼–è¾‘</button>
    <button class="btn btn-primary" onclick="copyAllCode()">ğŸ“‹ å¤åˆ¶æ–‡ç« ä»£ç </button>
  </div>
</div>

</div>

<!-- å›¾ç‰‡æ¨¡æ€æ¡† -->
<div class="modal-overlay" id="imageModal">
  <div class="modal">
    <div class="modal-head">
      <div class="modal-title">æ·»åŠ å›¾ç‰‡</div>
      <button class="modal-close" onclick="closeImageModal()">Ã—</button>
    </div>
    <div class="modal-body">
      <input type="text" class="modal-input" id="imageUrlInput" placeholder="ç²˜è´´å›¾ç‰‡é“¾æ¥ (https://...)">
      <div class="modal-divider">æˆ–</div>
      <div class="modal-upload" onclick="document.getElementById('imageFileInput').click()">
        <div style="font-size: 28px; margin-bottom: 6px;">ğŸ“¤</div>
        <div style="color: #666; font-size: 13px;">ç‚¹å‡»ä¸Šä¼ å›¾ç‰‡</div>
        <input type="file" id="imageFileInput" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
      </div>
    </div>
    <div class="modal-foot">
      <button class="btn btn-secondary" onclick="closeImageModal()">å–æ¶ˆ</button>
      <button class="btn btn-primary" onclick="confirmImage()">ç¡®å®š</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// ==================== çŠ¶æ€ç®¡ç† ====================
let currentStep = 1;
let currentMode = 'A';
let currentStyleTab = 'preset';
let currentStyle = 'catgate';
let currentScheme = 'morandi';
let blocks = [];
let editingImageIndex = null;
let materials = {};

// é…è‰²æ–¹æ¡ˆ
const schemes = {
  morandi: { primary: '#9b8b7d', text: '#5a5a5a', textLight: '#777', bgWarm: '#f7f5f3', bgWarmEnd: '#efe9e4', bgCard: '#f7f5f3', border: '#c4b5a5' },
  green: { primary: '#5d8a66', text: '#3d4a3f', textLight: '#666', bgWarm: '#f4f9f5', bgWarmEnd: '#e8f2ea', bgCard: '#f4f9f5', border: '#7eb085' },
  purple: { primary: '#8b7eb8', text: '#4a4558', textLight: '#666', bgWarm: '#f8f6fc', bgWarmEnd: '#f0ecf8', bgCard: '#f8f6fc', border: '#a99cd1' },
  milktea: { primary: '#a67c52', text: '#4d4035', textLight: '#6d5d4d', bgWarm: '#faf6f1', bgWarmEnd: '#f5ebe0', bgCard: '#faf6f1', border: '#c9a77c' },
  blackgold: { primary: '#c9a962', text: '#333', textLight: '#555', bgWarm: '#f9f8f5', bgWarmEnd: '#f3f0e8', bgCard: '#f9f8f5', border: '#c9a962' },
  coral: { primary: '#e07a5f', text: '#4a4a4a', textLight: '#666', bgWarm: '#fef7f5', bgWarmEnd: '#fceee9', bgCard: '#fef7f5', border: '#f2a07b' }
};

const blockTypeNames = {
  paragraph: 'æ®µè½', emphasis: 'å¼ºè°ƒ', quote: 'é‡‘å¥', heading: 'æ ‡é¢˜',
  list: 'åˆ—è¡¨', divider: 'åˆ†å‰²çº¿', image: 'å›¾ç‰‡', imagePlaceholder: 'å›¾ç‰‡å»ºè®®'
};

// é£æ ¼æè¿°ï¼ˆä¼˜åŒ–ç‰ˆï¼‰
const styleDescriptions = {
  catgate: 'ä¸“ä¸šæœ‰æ·±åº¦ä½†ä¸æ™¦æ¶©ï¼Œåƒä¸€ä½å€¼å¾—ä¿¡èµ–çš„æœ‹å‹åœ¨åˆ†äº«è§è§£ã€‚æœ‰å¿ƒç†å­¦ä¸“ä¸šåº•è•´ï¼Œå–„äºç”¨æ—¥å¸¸ä¾‹å­è§£é‡Šå¤æ‚æ¦‚å¿µï¼Œè®©è¯»è€…æ—¢æœ‰æ”¶è·æ„Ÿåˆè§‰å¾—äº²åˆ‡ã€‚é‡‘å¥æœ‰æ´å¯ŸåŠ›ï¼Œèƒ½è®©äººã€ŒåŸæ¥å¦‚æ­¤ã€ã€‚',
  lemon: 'è½»æ¾æ´»æ³¼ã€å¹´è½»åŒ–ã€æœ‰è¶£å‘³ï¼Œåƒå’Œå¥½æœ‹å‹èŠå¤©ä¸€æ ·è‡ªç„¶ã€‚å–„ç”¨æ¯”å–»å’Œç½‘ç»œç”¨è¯­ï¼Œè®©ä¸“ä¸šå†…å®¹ä¹Ÿå˜å¾—å¹³æ˜“è¿‘äººã€‚',
  healing: 'æ¸©æš–æ²»æ„ˆã€å…±æƒ…æ„Ÿå¼ºã€æƒ…æ„Ÿå‘ã€‚åƒä¸€æ¯çƒ­å¯å¯ï¼Œè®©è¯»è€…æ„Ÿåˆ°è¢«ç†è§£å’ŒæŠšæ…°ã€‚å–„äºæ•æ‰ç»†è…»çš„æƒ…æ„Ÿï¼Œæ–‡å­—æœ‰ç–—æ„ˆåŠ›é‡ã€‚',
  hardcore: 'ç¡¬æ ¸å¹²è´§ã€ä¸“ä¸šæ·±åº¦ã€ä¿¡æ¯å¯†é›†ã€‚é€»è¾‘ä¸¥è°¨ï¼Œè®ºæ®æ‰å®ï¼Œé€‚åˆæƒ³æ·±å…¥å­¦ä¹ çš„è¯»è€…ã€‚æ¯ä¸€æ®µéƒ½æœ‰å®æ‰“å®çš„çŸ¥è¯†ç‚¹ã€‚',
  story: 'æ•…äº‹é©±åŠ¨ã€æ¡ˆä¾‹ä¸°å¯Œã€å™äº‹æ„Ÿå¼ºã€‚ç”¨çœŸå®æˆ–å…¸å‹çš„æ•…äº‹æ¥ä¼ é€’è§‚ç‚¹ï¼Œè®©è¯»è€…åœ¨æ•…äº‹ä¸­è‡ªç„¶é¢†æ‚Ÿã€‚',
  mimeng: 'æƒ…ç»ªå¼ åŠ›å¼ºã€é‡‘å¥å¯†é›†ã€è§‚ç‚¹çŠ€åˆ©ã€çŸ­å¥ä¸ºä¸»ã€‚æ¯ä¸€å¥éƒ½æœ‰å†²å‡»åŠ›ï¼Œè®©è¯»è€…å¿ä¸ä½ç‚¹å¤´æˆ–è½¬å‘ã€‚',
  kaizhi: 'è®¤çŸ¥ç§‘å­¦è§†è§’ã€ä¿¡æ¯å¯†åº¦é«˜ã€æœ‰å­¦æœ¯åº•è•´ã€é€»è¾‘ä¸¥å¯†ã€‚å¼•ç”¨ç ”ç©¶å’Œç†è®ºï¼Œä½†è¡¨è¾¾æ¸…æ™°æ˜“æ‡‚ï¼Œé€‚åˆæ±‚çŸ¥æ¬²å¼ºçš„è¯»è€…ã€‚',
  zhihu: 'é€»è¾‘æ¸…æ™°ã€è®ºæ®å……åˆ†ã€ä¸“ä¸šå¯ä¿¡ã€ç»“æ„åŒ–å¼ºã€‚åƒä¸€ç¯‡ç²¾å¿ƒç»„ç»‡çš„å›ç­”ï¼Œè®©è¯»è€…ä¿¡æœã€‚',
  lifestyle: 'ç²¾è‡´ç¾å­¦ã€æœ‰å“å‘³ã€ä¸è¯´æ•™ã€ç”Ÿæ´»åŒ–ã€‚æ–‡å­—æœ‰è´¨æ„Ÿï¼Œä¼ é€’ä¸€ç§ç†æƒ³ç”Ÿæ´»çš„å‘å¾€ã€‚'
};

// ç‰©æ–™ç±»å‹å®šä¹‰
const materialTypes = [
  { id: 'pyq_author', name: 'æœ‹å‹åœˆï¼ˆä½œè€…ç‰ˆï¼‰', icon: 'ğŸ“±' },
  { id: 'pyq_assistant', name: 'æœ‹å‹åœˆï¼ˆè½¬å‘ç‰ˆï¼‰', icon: 'ğŸ“±' },
  { id: 'xiaohongshu', name: 'å°çº¢ä¹¦æ–‡æ¡ˆ', icon: 'ğŸ“•' },
  { id: 'xhs_titles', name: 'å°çº¢ä¹¦æ ‡é¢˜', icon: 'ğŸ“•' },
  { id: 'community', name: 'ç¤¾ç¾¤è½¬å‘è¯æœ¯', icon: 'ğŸ‘¥' },
  { id: 'private', name: 'ç§èŠæ¨èè¯æœ¯', icon: 'ğŸ’¬' },
  { id: 'titles', name: 'æ–‡ç« æ ‡é¢˜å¤‡é€‰', icon: 'ğŸ“°' },
  { id: 'audience', name: 'ç›®æ ‡äººç¾¤ç”»åƒ', icon: 'ğŸ¯' },
  { id: 'quotes', name: 'é‡‘å¥å¡ç‰‡æ–‡æ¡ˆ', icon: 'ğŸ’' },
  { id: 'video', name: 'çŸ­è§†é¢‘å£æ’­æ–‡æ¡ˆ', icon: 'ğŸ¬' },
  { id: 'secondary', name: 'æ¬¡æ¡/è½¬è½½ç‰ˆ', icon: 'ğŸ“„' },
  { id: 'seo', name: 'SEOå…³é”®è¯', icon: 'ğŸ”' }
];

// ==================== æ­¥éª¤å¯¼èˆª ====================
function goToStep(step) {
  if (step === 2) {
    generatePrompt();
  }
  
  currentStep = step;
  document.querySelectorAll('.step-panel').forEach(p => p.classList.remove('active'));
  document.querySelector(`.step-panel[data-step="${step}"]`).classList.add('active');
  
  document.querySelectorAll('.step-tab').forEach(t => {
    t.classList.remove('active', 'done');
    const s = parseInt(t.dataset.step);
    if (s < step) t.classList.add('done');
    if (s === step) t.classList.add('active');
  });
  
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

// ==================== æ¨¡å¼é€‰æ‹© ====================
function selectMode(mode) {
  currentMode = mode;
  document.querySelectorAll('.mode-card').forEach(c => {
    c.classList.toggle('active', c.dataset.mode === mode);
  });
  
  const styleSection = document.getElementById('styleSection');
  if (mode === 'A') {
    styleSection.classList.add('hidden');
  } else {
    styleSection.classList.remove('hidden');
  }
}

// ==================== é£æ ¼é€‰æ‹© ====================
function switchStyleTab(tab) {
  currentStyleTab = tab;
  document.querySelectorAll('.style-tab').forEach(t => {
    t.classList.toggle('active', t.dataset.tab === tab);
  });
  document.querySelectorAll('.style-panel').forEach(p => {
    p.classList.toggle('hidden', p.dataset.panel !== tab);
  });
}

function selectStyle(style) {
  currentStyle = style;
  document.querySelectorAll('.style-option').forEach(o => {
    o.classList.toggle('active', o.dataset.style === style);
  });
}

// ==================== ç”Ÿæˆæç¤ºè¯ï¼ˆä¼˜åŒ–ç‰ˆï¼‰ ====================
function generatePrompt() {
  let prompt = '';
  
  if (currentMode === 'A') {
    // æ¨¡å¼Aï¼šæ’ç‰ˆä¼˜åŒ–
    prompt = `ä½ æ˜¯ä¸€ä½èµ„æ·±å…¬ä¼—å·æ’ç‰ˆç¼–è¾‘ï¼Œè¯·å¸®æˆ‘ä¼˜åŒ–æ–‡ç« çš„æ’ç‰ˆæ ¼å¼ã€‚

## ä½ éœ€è¦åšçš„äº‹

1. **æç‚¼é‡‘å¥**ï¼ˆæ¯ç¯‡3-5å¥ï¼‰
   - ç”¨ \`>\` æ ‡è®°
   - å¥½é‡‘å¥çš„æ ‡å‡†ï¼šæœ‰æ´å¯Ÿã€åå¸¸è¯†ã€èƒ½å¼•å‘å…±é¸£ã€è®©äººæƒ³æˆªå›¾åˆ†äº«
   - é‡‘å¥å¯é•¿å¯çŸ­ï¼Œå…³é”®æ˜¯è¦æœ‰åŠ›é‡ï¼Œä¸è¦ä¸ºäº†çŸ­è€Œä¸¢å¤±æ„ä¹‰
   - ç¤ºä¾‹ï¼š> æˆ‘ä»¬ç„¦è™‘çš„ä¸æ˜¯æœªæ¥ï¼Œè€Œæ˜¯å¯¹æœªæ¥çš„æƒ³è±¡ã€‚

2. **æ ‡è®°å¼ºè°ƒ**
   - ç”¨ \`**æ–‡å­—**\` æ ‡è®°å…³é”®æ¦‚å¿µã€é‡è¦æœ¯è¯­
   - æ¯æ®µæœ€å¤š1-2å¤„ï¼Œä¸è¦è¿‡åº¦å¼ºè°ƒ

3. **æ·»åŠ å°æ ‡é¢˜**
   - ç”¨ \`## æ ‡é¢˜\` æ ‡è®°
   - åˆ’åˆ†æ–‡ç« çš„å¤§ç»“æ„ï¼Œé€šå¸¸3-5ä¸ª

4. **æ’å…¥åˆ†å‰²çº¿**
   - ç”¨ \`---\` æ ‡è®°
   - æ”¾åœ¨ä¸»é¢˜è½¬æ¢å¤„ï¼Œæ¯ç¯‡2-4å¤„

5. **å¤„ç†åˆ—è¡¨**
   - ç”¨ \`- åˆ—è¡¨é¡¹\` æ ‡è®°
   - 3ä¸ªä»¥ä¸Šå¹¶åˆ—é¡¹æ—¶ä½¿ç”¨

6. **å»ºè®®é…å›¾ä½ç½®**
   - ç”¨ \`![å›¾ç‰‡](å»ºè®®ï¼šæè¿°)\` æ ‡è®°
   - æ¯600-800å­—å»ºè®®ä¸€å¼ 
   - æ”¾åœ¨ä¸»é¢˜è½¬æ¢æˆ–æƒ…æ„Ÿé«˜æ½®å¤„
   - æè¿°è¦å…·ä½“ï¼Œä¾¿äºé…å›¾
   - ç¤ºä¾‹ï¼š![å›¾ç‰‡](å»ºè®®ï¼šä¸€ä¸ªäººåœ¨çª—è¾¹çœ‹é›¨ï¼Œå®‰é™æ€è€ƒçš„ç”»é¢)

## æ ¼å¼è§„åˆ™ï¼ˆéå¸¸é‡è¦ï¼‰

- é‡‘å¥ï¼ˆ>ï¼‰åé¢ä¸èƒ½ç´§è·Ÿå¦ä¸€ä¸ªé‡‘å¥ï¼Œä¸­é—´è¦æœ‰æ­£æ–‡
- æ ‡é¢˜ï¼ˆ##ï¼‰åé¢ä¸èƒ½ç´§è·Ÿå¦ä¸€ä¸ªæ ‡é¢˜
- ä¿ç•™åŸæ–‡æ‰€æœ‰æ ¸å¿ƒä¿¡æ¯
- é•¿æ®µè½æ‹†æˆçŸ­æ®µè½ï¼ˆæ¯æ®µ3-5å¥ï¼‰

## æˆ‘çš„æ–‡ç« 

[æŠŠä½ çš„æ–‡ç« ç²˜è´´åœ¨è¿™é‡Œ]

---
è¯·ç›´æ¥è¾“å‡ºå¤„ç†åçš„æ–‡ç« ï¼Œä¸è¦è§£é‡Šã€‚`;

  } else if (currentMode === 'B') {
    // æ¨¡å¼Bï¼šä¸»é¢˜åˆ›ä½œ
    const styleDesc = currentStyleTab === 'custom' 
      ? document.getElementById('customStyleInput').value || 'ä¸“ä¸šä½†æ˜“è¯»'
      : styleDescriptions[currentStyle] || '';
    
    prompt = `ä½ æ˜¯ä¸€ä½èµ„æ·±å…¬ä¼—å·çˆ†æ¬¾å†™æ‰‹ï¼Œè¯·æ ¹æ®æˆ‘ç»™çš„ä¸»é¢˜åˆ›ä½œä¸€ç¯‡é«˜è´¨é‡æ–‡ç« ã€‚

## æ–‡ç« é£æ ¼
${styleDesc}

## æ–‡ç« è¦æ±‚
1. å­—æ•°ï¼š1500-2500å­—
2. å¼€å¤´3ç§’æŠ“ä½è¯»è€…ï¼ˆç”¨æ•…äº‹ã€é—®é¢˜ã€åå¸¸è¯†è§‚ç‚¹ç­‰ï¼‰
3. æ¯300-400å­—è¦æœ‰ä¸€ä¸ªã€Œçˆ½ç‚¹ã€æˆ–ã€Œå…±é¸£ç‚¹ã€
4. é‡‘å¥è¦æœ‰æ´å¯ŸåŠ›ï¼Œè®©äººæƒ³æˆªå›¾åˆ†äº«
5. ç»“å°¾è¦æœ‰è¡ŒåŠ¨å·å¬æˆ–æƒ…æ„Ÿå‡å

## è¾“å‡ºæ ¼å¼ï¼ˆå¿…é¡»ä¸¥æ ¼éµå®ˆï¼‰

ç”¨ä»¥ä¸‹Markdownæ ¼å¼è¾“å‡ºï¼š

- \`> é‡‘å¥\` â€” æœ‰æ´å¯Ÿã€æœ‰åŠ›é‡çš„å¥å­ï¼Œæ¯ç¯‡4-6å¥
- \`**å¼ºè°ƒ**\` â€” å…³é”®è¯å¼ºè°ƒ
- \`## å°æ ‡é¢˜\` â€” åˆ’åˆ†ç»“æ„ï¼Œ3-5ä¸ª
- \`---\` â€” åˆ†å‰²çº¿ï¼Œæ”¾åœ¨ä¸»é¢˜è½¬æ¢å¤„
- \`- åˆ—è¡¨é¡¹\` â€” å¹¶åˆ—å†…å®¹
- \`![å›¾ç‰‡](å»ºè®®ï¼šå…·ä½“æè¿°)\` â€” é…å›¾å»ºè®®ï¼Œæ¯600å­—ä¸€å¼ 

## æ ¼å¼è§„åˆ™ï¼ˆéå¸¸é‡è¦ï¼‰
- é‡‘å¥ï¼ˆ>ï¼‰ä¹‹é—´ä¸èƒ½è¿ç»­ï¼Œä¸­é—´å¿…é¡»æœ‰æ­£æ–‡æ®µè½
- æ ‡é¢˜ï¼ˆ##ï¼‰ä¹‹é—´ä¸èƒ½è¿ç»­
- å›¾ç‰‡å»ºè®®è¦æœ‰å…·ä½“æè¿°ï¼Œæ¯”å¦‚ã€Œå»ºè®®ï¼šä¸€ä¸ªå¹´è½»äººåœ¨å’–å•¡é¦†ä¸“æ³¨å·¥ä½œã€

## æˆ‘çš„ä¸»é¢˜

[åœ¨è¿™é‡Œè¾“å…¥ä½ çš„ä¸»é¢˜æˆ–æƒ³æ³•]

---
è¯·ç›´æ¥è¾“å‡ºå®Œæ•´æ–‡ç« ï¼Œä¸è¦è§£é‡Šã€‚`;

  } else if (currentMode === 'C') {
    // æ¨¡å¼Cï¼šé•¿ç¨¿æç‚¼
    const styleDesc = currentStyleTab === 'custom' 
      ? document.getElementById('customStyleInput').value || 'ä¸“ä¸šä½†æ˜“è¯»'
      : styleDescriptions[currentStyle] || '';
    
    prompt = `ä½ æ˜¯ä¸€ä½èµ„æ·±å†…å®¹ç¼–è¾‘ï¼Œè¯·ä»æˆ‘çš„é•¿ç´ æä¸­æç‚¼å‡ºä¸€ç¯‡ç²¾åæ–‡ç« ã€‚

## æ–‡ç« é£æ ¼
${styleDesc}

## æç‚¼åŸåˆ™
1. æ‰¾å‡ºç´ æä¸­æœ€æœ‰ä»·å€¼çš„3-5ä¸ªæ ¸å¿ƒè§‚ç‚¹
2. åˆ é™¤é‡å¤ã€è·‘é¢˜ã€å£è¯­åŒ–çš„éƒ¨åˆ†
3. é‡æ–°ç»„ç»‡ç»“æ„ï¼Œè®©é€»è¾‘æ›´æ¸…æ™°
4. ä¿ç•™ç²¾å½©çš„æ¡ˆä¾‹å’Œé‡‘å¥
5. æœ€ç»ˆå­—æ•°æ§åˆ¶åœ¨1500-2500å­—

## è¾“å‡ºæ ¼å¼ï¼ˆå¿…é¡»ä¸¥æ ¼éµå®ˆï¼‰

ç”¨ä»¥ä¸‹Markdownæ ¼å¼è¾“å‡ºï¼š

- \`> é‡‘å¥\` â€” ä»åŸæ–‡æç‚¼æˆ–æ”¹å†™ï¼Œè¦æœ‰æ´å¯ŸåŠ›
- \`**å¼ºè°ƒ**\` â€” å…³é”®æ¦‚å¿µ
- \`## å°æ ‡é¢˜\` â€” åˆ’åˆ†ç»“æ„
- \`---\` â€” åˆ†å‰²çº¿
- \`- åˆ—è¡¨é¡¹\` â€” å¹¶åˆ—å†…å®¹
- \`![å›¾ç‰‡](å»ºè®®ï¼šå…·ä½“æè¿°)\` â€” é…å›¾å»ºè®®ï¼Œæ¯600å­—ä¸€å¼ 

## æ ¼å¼è§„åˆ™ï¼ˆéå¸¸é‡è¦ï¼‰
- é‡‘å¥ï¼ˆ>ï¼‰ä¹‹é—´ä¸èƒ½è¿ç»­ï¼Œä¸­é—´å¿…é¡»æœ‰æ­£æ–‡æ®µè½
- æ ‡é¢˜ï¼ˆ##ï¼‰ä¹‹é—´ä¸èƒ½è¿ç»­
- å›¾ç‰‡å»ºè®®è¦å†™æ¸…æ¥šå…·ä½“åœºæ™¯

## æˆ‘çš„åŸå§‹ç´ æ

[æŠŠä½ çš„é€å­—ç¨¿/ç¬”è®°ç²˜è´´åœ¨è¿™é‡Œ]

---
è¯·ç›´æ¥è¾“å‡ºæç‚¼åçš„æ–‡ç« ï¼Œä¸è¦è§£é‡Šã€‚`;

  } else if (currentMode === 'D') {
    // æ¨¡å¼Dï¼šç´ ææ•´åˆ
    const styleDesc = currentStyleTab === 'custom' 
      ? document.getElementById('customStyleInput').value || 'ä¸“ä¸šä½†æ˜“è¯»'
      : styleDescriptions[currentStyle] || '';
    
    prompt = `ä½ æ˜¯ä¸€ä½èµ„æ·±å†…å®¹åˆ›ä½œè€…ï¼Œè¯·å¸®æˆ‘æŠŠå¤šä¸ªç´ ææ•´åˆæˆä¸€ç¯‡åŸåˆ›æ–‡ç« ã€‚

## æ–‡ç« é£æ ¼
${styleDesc}

## æ•´åˆåŸåˆ™ï¼ˆé¿å…æŠ„è¢­ï¼‰
1. ç†è§£æ¯ä¸ªç´ æçš„ã€æ ¸å¿ƒè§‚ç‚¹ã€‘ï¼Œè€Œéç…§æ¬è¡¨è¾¾
2. ç”¨ã€å…¨æ–°çš„è¯­è¨€ã€‘é‡æ–°é˜è¿°
3. èå…¥æˆ‘è‡ªå·±çš„è§†è§’è¿›è¡Œè¯„è®ºå’Œå»¶ä¼¸
4. é‡æ–°è®¾è®¡æ–‡ç« ç»“æ„
5. æœ€ç»ˆå­—æ•°1500-2500å­—

## è¾“å‡ºæ ¼å¼ï¼ˆå¿…é¡»ä¸¥æ ¼éµå®ˆï¼‰

ç”¨ä»¥ä¸‹Markdownæ ¼å¼è¾“å‡ºï¼š

- \`> é‡‘å¥\` â€” å¿…é¡»æ˜¯åŸåˆ›è¡¨è¾¾ï¼Œæœ‰æ´å¯ŸåŠ›
- \`**å¼ºè°ƒ**\` â€” å…³é”®æ¦‚å¿µ
- \`## å°æ ‡é¢˜\` â€” åˆ’åˆ†ç»“æ„
- \`---\` â€” åˆ†å‰²çº¿
- \`- åˆ—è¡¨é¡¹\` â€” å¹¶åˆ—å†…å®¹
- \`![å›¾ç‰‡](å»ºè®®ï¼šå…·ä½“æè¿°)\` â€” é…å›¾å»ºè®®ï¼Œæ¯600å­—ä¸€å¼ 

## æ ¼å¼è§„åˆ™ï¼ˆéå¸¸é‡è¦ï¼‰
- é‡‘å¥ï¼ˆ>ï¼‰ä¹‹é—´ä¸èƒ½è¿ç»­ï¼Œä¸­é—´å¿…é¡»æœ‰æ­£æ–‡æ®µè½
- æ ‡é¢˜ï¼ˆ##ï¼‰ä¹‹é—´ä¸èƒ½è¿ç»­

## æˆ‘çš„ç´ æç‰‡æ®µ

[æŠŠä½ æ”¶é›†çš„å„ç§ç´ æç²˜è´´åœ¨è¿™é‡Œï¼Œç”¨ --- åˆ†éš”ä¸åŒç´ æ]

## æˆ‘çš„è§†è§’/æƒ³å¼ºè°ƒçš„è§‚ç‚¹ï¼ˆå¯é€‰ï¼‰

[å¦‚æœæœ‰ä½ è‡ªå·±çš„è§‚ç‚¹æƒ³èå…¥ï¼Œå†™åœ¨è¿™é‡Œ]

---
è¯·ç›´æ¥è¾“å‡ºåŸåˆ›æ–‡ç« ï¼Œä¸è¦è§£é‡Šã€‚`;
  }
  
  document.getElementById('promptText').textContent = prompt;
  
  // æ›´æ–°æ­¥éª¤3çš„æç¤º
  const tipStep3 = document.getElementById('tipStep3');
  if (currentMode === 'A') {
    tipStep3.innerHTML = 'æ›¿æ¢ <code>[æŠŠä½ çš„æ–‡ç« ç²˜è´´åœ¨è¿™é‡Œ]</code> éƒ¨åˆ†ï¼Œå‘ç»™AI';
  } else if (currentMode === 'B') {
    tipStep3.innerHTML = 'æ›¿æ¢ <code>[åœ¨è¿™é‡Œè¾“å…¥ä½ çš„ä¸»é¢˜æˆ–æƒ³æ³•]</code> éƒ¨åˆ†ï¼Œå‘ç»™AI';
  } else if (currentMode === 'C') {
    tipStep3.innerHTML = 'æ›¿æ¢ <code>[æŠŠä½ çš„é€å­—ç¨¿/ç¬”è®°ç²˜è´´åœ¨è¿™é‡Œ]</code> éƒ¨åˆ†ï¼Œå‘ç»™AI';
  } else {
    tipStep3.innerHTML = 'æ›¿æ¢ <code>[ç´ æç‰‡æ®µ]</code> éƒ¨åˆ†ï¼Œå‘ç»™AI';
  }
}

function copyPrompt() {
  const prompt = document.getElementById('promptText').textContent;
  navigator.clipboard.writeText(prompt).then(() => showToast('âœ… æç¤ºè¯å·²å¤åˆ¶'));
}

// ==================== å†…å®¹è§£æï¼ˆä¼˜åŒ–ç‰ˆï¼‰ ====================
function updateWordCount() {
  const text = document.getElementById('inputText').value;
  document.getElementById('wordCount').textContent = text.replace(/\s/g, '').length + ' å­—';
}

function parseContent() {
  const text = document.getElementById('inputText').value.trim();
  if (!text) { showToast('âš ï¸ è¯·å…ˆç²˜è´´å†…å®¹'); return; }
  
  blocks = [];
  const lines = text.split('\n');
  let i = 0;
  
  while (i < lines.length) {
    const line = lines[i].trim();
    if (!line) { i++; continue; }
    
    // åˆ†å‰²çº¿
    if (/^[-*_]{3,}$/.test(line)) {
      blocks.push({ type: 'divider', content: '' });
      i++; continue;
    }
    
    // å›¾ç‰‡ï¼ˆæ”¯æŒå¤šç§æ ¼å¼ï¼‰
    const imgMatch = line.match(/^!\[([^\]]*)\]\(([^)]+)\)$/);
    if (imgMatch) {
      const desc = imgMatch[1];
      const src = imgMatch[2];
      if (src.startsWith('http') || src.startsWith('data:')) {
        blocks.push({ type: 'image', content: src });
      } else {
        // æå–æè¿°æ–‡å­—
        const suggestion = src.replace(/^å»ºè®®[ï¼š:]\s*/, '');
        const imgPrompt = generateImagePrompt(suggestion, text);
        blocks.push({ type: 'imagePlaceholder', content: suggestion, imgPrompt: imgPrompt });
      }
      i++; continue;
    }
    
    // æ ‡é¢˜
    if (/^#{1,3}\s+/.test(line)) {
      const headingContent = line.replace(/^#{1,3}\s+/, '');
      // æ£€æŸ¥æ˜¯å¦å’Œä¸Šä¸€ä¸ªä¹Ÿæ˜¯æ ‡é¢˜ï¼Œå¦‚æœæ˜¯ï¼Œåˆå¹¶æˆ–è½¬ä¸ºæ®µè½
      if (blocks.length > 0 && blocks[blocks.length - 1].type === 'heading') {
        // æŠŠå½“å‰æ ‡é¢˜è½¬ä¸ºå¼ºè°ƒæ®µè½
        blocks.push({ type: 'emphasis', content: headingContent });
      } else {
        blocks.push({ type: 'heading', content: headingContent });
      }
      i++; continue;
    }
    
    // å¼•ç”¨/é‡‘å¥
    if (/^>\s*/.test(line)) {
      let q = line.replace(/^>\s*/, '');
      // åˆå¹¶è¿ç»­çš„å¼•ç”¨è¡Œ
      while (i + 1 < lines.length && /^>\s*/.test(lines[i + 1].trim())) {
        i++;
        q += '\n' + lines[i].trim().replace(/^>\s*/, '');
      }
      
      // æ™ºèƒ½åˆ¤æ–­ï¼šå¦‚æœå¤ªé•¿ï¼ˆè¶…è¿‡100å­—ï¼‰ï¼Œå¯èƒ½æ˜¯AIç†è§£é”™è¯¯ï¼Œè½¬ä¸ºæ®µè½
      if (q.length > 100) {
        blocks.push({ type: 'paragraph', content: q });
      } else {
        // æ£€æŸ¥æ˜¯å¦å’Œä¸Šä¸€ä¸ªä¹Ÿæ˜¯é‡‘å¥
        if (blocks.length > 0 && blocks[blocks.length - 1].type === 'quote') {
          // åœ¨ä¸­é—´æ’å…¥ä¸€ä¸ªç©ºæ®µè½æç¤º
          blocks.push({ type: 'paragraph', content: 'ï¼ˆæ­¤å¤„å»ºè®®è¡¥å……è¿‡æ¸¡å†…å®¹ï¼‰' });
        }
        blocks.push({ type: 'quote', content: q });
      }
      i++; continue;
    }
    
    // åˆ—è¡¨
    if (/^[-*+]\s+/.test(line) || /^\d+\.\s+/.test(line)) {
      const items = [];
      while (i < lines.length) {
        const l = lines[i].trim();
        if (/^[-*+]\s+/.test(l)) items.push(l.replace(/^[-*+]\s+/, ''));
        else if (/^\d+\.\s+/.test(l)) items.push(l.replace(/^\d+\.\s+/, ''));
        else if (!l) break;
        else break;
        i++;
      }
      blocks.push({ type: 'list', content: items.join('\n') });
      continue;
    }
    
    // çº¯ç²—ä½“è¡Œ
    if (/^\*\*[^*]+\*\*$/.test(line)) {
      const c = line.replace(/^\*\*|\*\*$/g, '');
      blocks.push({ type: c.length <= 20 ? 'heading' : 'emphasis', content: c });
      i++; continue;
    }
    
    // æ™®é€šæ®µè½
    let para = line;
    while (i + 1 < lines.length) {
      const next = lines[i + 1].trim();
      if (!next || isSpecialLine(next)) break;
      para += '\n' + next;
      i++;
    }
    blocks.push({ type: 'paragraph', content: para });
    i++;
  }
  
  // æ˜¾ç¤ºç¼–è¾‘å™¨
  document.getElementById('inputCard').style.display = 'none';
  document.getElementById('editorSection').style.display = 'grid';
  
  renderBlocks();
  updatePreview();
  showToast(`âœ… è§£æå‡º ${blocks.length} ä¸ªæ¨¡å—`);
}

function isSpecialLine(line) {
  return /^[-*_]{3,}$/.test(line) || /^#{1,3}\s+/.test(line) || /^>\s*/.test(line) ||
         /^[-*+]\s+/.test(line) || /^\d+\.\s+/.test(line) || /^!\[/.test(line) || /^\*\*[^*]+\*\*$/.test(line);
}

function showInputCard() {
  document.getElementById('inputCard').style.display = 'block';
  document.getElementById('editorSection').style.display = 'none';
}

// ç”ŸæˆAIå›¾ç‰‡æç¤ºè¯
function generateImagePrompt(suggestion, articleContent) {
  const keywords = suggestion.replace(/^å»ºè®®[ï¼š:]\s*/, '');
  
  const colorTones = {
    morandi: 'soft muted colors, warm beige and grey tones, elegant minimalist',
    green: 'fresh green tones, natural forest colors, calming peaceful',
    purple: 'soft lavender and purple tones, dreamy ethereal',
    milktea: 'warm milk tea colors, cozy brown tones, comfortable',
    blackgold: 'luxury black and gold, elegant sophisticated',
    coral: 'warm coral and peach tones, vibrant yet soft'
  };
  
  const colorTone = colorTones[currentScheme] || colorTones.morandi;
  
  return `A beautiful illustration for a WeChat article: ${keywords}. Style: ${colorTone}, clean modern design, suitable for social media, high quality, professional`;
}

// ==================== æ¨¡å—æ¸²æŸ“ ====================
function renderBlocks() {
  const container = document.getElementById('blocksList');
  if (!blocks.length) {
    container.innerHTML = '<div class="text-center text-muted" style="padding: 40px;">æš‚æ— å†…å®¹</div>';
    document.getElementById('blockCount').textContent = '(0)';
    return;
  }
  
  container.innerHTML = blocks.map((b, i) => renderBlockItem(b, i)).join('');
  document.getElementById('blockCount').textContent = `(${blocks.length})`;
}

function renderBlockItem(block, idx) {
  const typeOpts = Object.entries(blockTypeNames)
    .map(([v, l]) => `<option value="${v}" ${block.type === v ? 'selected' : ''}>${l}</option>`).join('');
  
  let content = '';
  
  if (block.type === 'divider') {
    content = '<div class="divider-preview">Â· Â· Â·</div>';
  } else if (block.type === 'image') {
    content = `
      <div class="img-block-preview">${block.content ? `<img src="${block.content}">` : ''}</div>
      <input type="text" class="block-input" style="min-height:auto;" value="${block.content || ''}" placeholder="å›¾ç‰‡é“¾æ¥" 
             onchange="updateBlock(${idx}, this.value)" onblur="updatePreview()">`;
  } else if (block.type === 'imagePlaceholder') {
    content = `
      <div class="img-placeholder">
        <div class="img-placeholder-text">ğŸ“· ${block.content}</div>
        <button class="btn btn-secondary btn-sm" onclick="openImageModalFor(${idx})">ä¸Šä¼ å›¾ç‰‡</button>
      </div>
      <div class="img-prompt-box">
        <div class="img-prompt-label">
          <span>ğŸ¨ AIç»˜å›¾æç¤ºè¯</span>
          <button class="btn btn-sm btn-outline" onclick="copyImagePrompt(${idx})">å¤åˆ¶</button>
        </div>
        <div class="img-prompt-text">${block.imgPrompt || ''}</div>
        <div class="img-jump-btns">
          <a href="https://gemini.google.com" target="_blank" class="btn btn-gemini">Gemini</a>
          <a href="https://chat.openai.com" target="_blank" class="btn btn-secondary">DALL-E</a>
          <a href="https://yige.baidu.com" target="_blank" class="btn btn-secondary">æ–‡å¿ƒä¸€æ ¼</a>
          <a href="https://www.midjourney.com" target="_blank" class="btn btn-secondary">Midjourney</a>
        </div>
      </div>`;
  } else {
    content = `<textarea class="block-input" onchange="updateBlock(${idx}, this.value)" onblur="updatePreview()">${block.content || ''}</textarea>`;
  }
  
  return `
    <div class="block-item">
      <div class="block-head">
        <select class="block-type-sel" onchange="changeBlockType(${idx}, this.value)">${typeOpts}</select>
        <div class="block-actions">
          <button class="block-act-btn img" onclick="insertImageAfter(${idx})" title="æ’å…¥å›¾ç‰‡">ğŸ–¼</button>
          <button class="block-act-btn" onclick="moveBlock(${idx}, -1)" title="ä¸Šç§»">â†‘</button>
          <button class="block-act-btn" onclick="moveBlock(${idx}, 1)" title="ä¸‹ç§»">â†“</button>
          <button class="block-act-btn del" onclick="deleteBlock(${idx})" title="åˆ é™¤">Ã—</button>
        </div>
      </div>
      <div class="block-body">${content}</div>
    </div>`;
}

function updateBlock(i, v) { blocks[i].content = v; }
function changeBlockType(i, t) { blocks[i].type = t; renderBlocks(); updatePreview(); }
function moveBlock(i, dir) {
  const j = i + dir;
  if (j < 0 || j >= blocks.length) return;
  [blocks[i], blocks[j]] = [blocks[j], blocks[i]];
  renderBlocks();
  updatePreview();
}
function deleteBlock(i) { blocks.splice(i, 1); renderBlocks(); updatePreview(); }
function addBlock(type) { 
  const imgPrompt = type === 'imagePlaceholder' ? generateImagePrompt('é…å›¾', '') : '';
  blocks.push({ type, content: '', imgPrompt }); 
  renderBlocks(); 
  updatePreview(); 
}

function copyImagePrompt(idx) {
  const prompt = blocks[idx]?.imgPrompt || '';
  navigator.clipboard.writeText(prompt).then(() => showToast('âœ… æç¤ºè¯å·²å¤åˆ¶'));
}

// ==================== å›¾ç‰‡æ¨¡æ€æ¡† ====================
function insertImageAfter(i) {
  editingImageIndex = i + 1;
  document.getElementById('imageUrlInput').value = '';
  document.getElementById('imageModal').classList.add('show');
}

function openImageModalFor(i) {
  editingImageIndex = i;
  document.getElementById('imageUrlInput').value = '';
  document.getElementById('imageModal').classList.add('show');
}

function closeImageModal() {
  document.getElementById('imageModal').classList.remove('show');
  editingImageIndex = null;
}

function confirmImage() {
  const url = document.getElementById('imageUrlInput').value.trim();
  if (editingImageIndex !== null && url) {
    if (blocks[editingImageIndex]?.type === 'imagePlaceholder' || blocks[editingImageIndex]?.type === 'image') {
      blocks[editingImageIndex] = { type: 'image', content: url };
    } else {
      blocks.splice(editingImageIndex, 0, { type: 'image', content: url });
    }
    renderBlocks();
    updatePreview();
    closeImageModal();
    showToast('âœ… å›¾ç‰‡å·²æ·»åŠ ');
  }
}

function handleImageUpload(e) {
  const file = e.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = ev => { document.getElementById('imageUrlInput').value = ev.target.result; };
    reader.readAsDataURL(file);
  }
}

// ==================== é¢„è§ˆï¼ˆä¼˜åŒ–ç‰ˆï¼‰ ====================
function updatePreview() {
  const container = document.getElementById('previewContent');
  if (!blocks.length) {
    container.innerHTML = '<div class="text-center text-muted" style="padding: 40px;">é¢„è§ˆå†…å®¹</div>';
    return;
  }
  container.innerHTML = blocks.map(b => generateBlockHTML(b)).join('');
}

function generateBlockHTML(block) {
  const s = schemes[currentScheme];
  
  switch (block.type) {
    case 'paragraph':
      let p = (block.content || '').replace(/\*\*([^*]+)\*\*/g, `<strong style="color:${s.primary};">$1</strong>`).replace(/\n/g, '<br>');
      return `<p style="font-size:15px;color:${s.text};line-height:2;letter-spacing:0.5px;margin-bottom:20px;text-align:justify;">${p}</p>`;
    
    case 'emphasis':
      return `<p style="font-size:15px;color:${s.text};line-height:2;margin-bottom:20px;"><strong style="color:${s.primary};">${block.content || ''}</strong></p>`;
    
    case 'heading':
      return `<p style="font-size:17px;color:${s.primary};font-weight:600;margin:28px 0 16px;letter-spacing:1px;">${block.content || ''}</p>`;
    
    case 'divider':
      return `<p style="text-align:center;color:${s.border};margin:28px 0;font-size:14px;letter-spacing:8px;">Â·Â·Â·</p>`;
    
    case 'quote':
      const len = (block.content || '').length;
      if (len <= 40) {
        // çŸ­é‡‘å¥ï¼šå±…ä¸­å¤§å­—
        return `<p style="font-size:17px;color:${s.primary};line-height:1.8;margin:28px 0;text-align:center;font-weight:600;letter-spacing:1px;">${block.content}</p>`;
      }
      // é•¿é‡‘å¥ï¼šå¸¦è¾¹æ¡†
      return `<section style="background:linear-gradient(135deg,${s.bgWarm},${s.bgWarmEnd});border-left:3px solid ${s.primary};padding:18px 20px;margin:24px 0;border-radius:0 10px 10px 0;">
        <p style="font-size:15px;color:${s.primary};line-height:1.9;margin:0;font-weight:500;">${(block.content || '').replace(/\n/g, '<br>')}</p>
      </section>`;
    
    case 'list':
      const items = (block.content || '').split('\n').filter(x => x.trim());
      const listHtml = items.map(item => {
        const c = item.replace(/\*\*([^*]+)\*\*/g, `<strong style="color:${s.primary};">$1</strong>`);
        return `<p style="font-size:14px;color:${s.textLight};line-height:2;margin-bottom:8px;padding-left:16px;position:relative;"><span style="position:absolute;left:0;color:${s.primary};">â†’</span>${c}</p>`;
      }).join('');
      return `<section style="background:${s.bgCard};padding:18px 20px;margin:24px 0;border-radius:10px;border:1px solid ${s.border};">${listHtml}</section>`;
    
    case 'image':
      return block.content ? `<p style="text-align:center;margin:24px 0;"><img src="${block.content}" style="max-width:100%;border-radius:10px;box-shadow:0 4px 12px rgba(0,0,0,0.08);"></p>` : '';
    
    case 'imagePlaceholder':
      return `<p style="text-align:center;margin:24px 0;padding:28px;background:linear-gradient(135deg,#fafafa,#f5f5f5);border-radius:10px;color:#999;font-size:13px;border:1px dashed #ddd;">ğŸ“· ${block.content || 'å»ºè®®æ’å…¥å›¾ç‰‡'}</p>`;
    
    default: return '';
  }
}

function generateFullCode() {
  return blocks.filter(b => b.type !== 'imagePlaceholder').map(b => generateBlockHTML(b)).join('');
}

function copyAllCode() {
  const code = generateFullCode();
  if (!code) { showToast('âš ï¸ æ— å†…å®¹'); return; }
  navigator.clipboard.writeText(code).then(() => showToast('âœ… ä»£ç å·²å¤åˆ¶'));
}

// ==================== è¥é”€ç‰©æ–™ï¼ˆä¼˜åŒ–ç‰ˆï¼‰ ====================
function generateMaterials() {
  const articleSummary = blocks
    .filter(b => b.type === 'paragraph' || b.type === 'quote' || b.type === 'heading')
    .map(b => b.content)
    .join('\n')
    .substring(0, 2000);
  
  if (!articleSummary.trim()) {
    showToast('âš ï¸ è¯·å…ˆåœ¨æ­¥éª¤3å®Œæˆæ–‡ç« æ’ç‰ˆ');
    return;
  }
  
  const prompt = `ä½ æ˜¯ä¸€ä½èµ„æ·±æ–°åª’ä½“è¿è¥ä¸“å®¶ï¼Œè¯·æ ¹æ®ä»¥ä¸‹å…¬ä¼—å·æ–‡ç« å†…å®¹ï¼Œç”Ÿæˆå…¨å¥—è¥é”€ç‰©æ–™ã€‚

## æ–‡ç« å†…å®¹
${articleSummary}

## è¯·ç”Ÿæˆä»¥ä¸‹12ç§ç‰©æ–™

ã€æœ‹å‹åœˆï¼ˆä½œè€…ç‰ˆï¼‰ã€‘
è¦æ±‚ï¼šç¬¬ä¸€äººç§°ï¼Œæœ‰ä¸ªäººæ„Ÿæ‚Ÿï¼Œå¼•å‘å¥½å¥‡ï¼Œ150å­—ä»¥å†…ï¼Œå¸¦emoji

ã€æœ‹å‹åœˆï¼ˆè½¬å‘ç‰ˆï¼‰ã€‘
è¦æ±‚ï¼šç¬¬ä¸‰äººç§°æ¨èï¼Œçªå‡ºæ–‡ç« ä»·å€¼ï¼Œå¼•å¯¼ç‚¹å‡»ï¼Œ150å­—ä»¥å†…

ã€å°çº¢ä¹¦æ–‡æ¡ˆã€‘
è¦æ±‚ï¼šå£è¯­åŒ–ã€æœ‰ç½‘æ„Ÿã€å¸¦è¯é¢˜æ ‡ç­¾ã€åˆ†æ®µæ¸…æ™°ã€300å­—å·¦å³

ã€å°çº¢ä¹¦æ ‡é¢˜ã€‘
è¦æ±‚ï¼š5ä¸ªå¤‡é€‰ï¼Œæœ‰æ•°å­—ã€æœ‰æƒ…ç»ªè¯ã€æœ‰ç—›ç‚¹ã€æ§åˆ¶åœ¨20å­—å†…

ã€ç¤¾ç¾¤è½¬å‘è¯æœ¯ã€‘
è¦æ±‚ï¼šé€‚åˆå¾®ä¿¡ç¾¤åˆ†äº«ï¼Œç®€æ´æœ‰åŠ›ï¼Œ100å­—ä»¥å†…

ã€ç§èŠæ¨èè¯æœ¯ã€‘
è¦æ±‚ï¼šåƒæœ‹å‹æ¨èï¼Œè‡ªç„¶ä¸è¥é”€ï¼Œ80å­—ä»¥å†…

ã€æ–‡ç« æ ‡é¢˜å¤‡é€‰ã€‘
è¦æ±‚ï¼š8ä¸ªä¸åŒé£æ ¼â€”â€”æ‚¬å¿µå‹ã€æ•°å­—å‹ã€ç—›ç‚¹å‹ã€å¥½å¥‡å‹ã€å…±é¸£å‹ç­‰

ã€ç›®æ ‡äººç¾¤ç”»åƒã€‘
è¦æ±‚ï¼š3-5ç±»æœ€é€‚åˆé˜…è¯»çš„äººç¾¤ï¼ŒåŒ…æ‹¬ç‰¹å¾å’Œç—›ç‚¹

ã€é‡‘å¥å¡ç‰‡æ–‡æ¡ˆã€‘
è¦æ±‚ï¼š5æ¡ï¼Œæ¯æ¡15-30å­—ï¼Œé€‚åˆåšæˆå›¾ç‰‡

ã€çŸ­è§†é¢‘å£æ’­æ–‡æ¡ˆã€‘
è¦æ±‚ï¼šå¼€å¤´æœ‰é’©å­ï¼Œ300å­—å·¦å³ï¼Œé€‚åˆ1åˆ†é’ŸçŸ­è§†é¢‘

ã€æ¬¡æ¡/è½¬è½½ç‰ˆã€‘
è¦æ±‚ï¼š100å­—ç®€ä»‹+æ ¸å¿ƒçœ‹ç‚¹

ã€SEOå…³é”®è¯ã€‘
è¦æ±‚ï¼š10-15ä¸ªæœç´¢å…³é”®è¯ï¼ŒåŒ…æ‹¬é•¿å°¾è¯

---
è¯·æŒ‰ä»¥ä¸Šæ ¼å¼è¾“å‡ºï¼Œæ¯ä¸ªç±»åˆ«ç”¨ã€ç±»åˆ«åã€‘æ ‡æ³¨ï¼Œå†…å®¹ç´§è·Ÿå…¶åã€‚`;

  document.getElementById('materialPromptText').textContent = prompt;
  document.getElementById('materialPromptCard').style.display = 'block';
  document.getElementById('materialInputCard').style.display = 'block';
  
  // åˆå§‹åŒ–ç‰©æ–™å¡ç‰‡
  initMaterialCards();
  
  showToast('âœ… æç¤ºè¯å·²ç”Ÿæˆï¼Œå¤åˆ¶åå‘ç»™AI');
}

function initMaterialCards() {
  const grid = document.getElementById('materialGrid');
  grid.innerHTML = materialTypes.map(mt => `
    <div class="material-card">
      <div class="material-head">
        <div class="material-title">${mt.icon} ${mt.name}</div>
        <button class="btn btn-sm btn-outline" onclick="copyMaterial('${mt.id}')">å¤åˆ¶</button>
      </div>
      <div class="material-content ${materials[mt.id] ? '' : 'empty'}" id="mat_${mt.id}">
        ${materials[mt.id] || 'ç­‰å¾…å¡«å……...'}
      </div>
    </div>
  `).join('');
  grid.style.display = 'grid';
  document.getElementById('materialActionsCard').style.display = 'block';
}

function copyMaterialPrompt() {
  const prompt = document.getElementById('materialPromptText').textContent;
  navigator.clipboard.writeText(prompt).then(() => showToast('âœ… æç¤ºè¯å·²å¤åˆ¶'));
}

// è§£æAIè¿”å›çš„ç‰©æ–™å†…å®¹
function parseMaterials() {
  const text = document.getElementById('materialInputText').value.trim();
  if (!text) {
    showToast('âš ï¸ è¯·å…ˆç²˜è´´AIè¿”å›çš„å†…å®¹');
    return;
  }
  
  // ç‰©æ–™åç§°æ˜ å°„
  const nameMap = {
    'æœ‹å‹åœˆï¼ˆä½œè€…ç‰ˆï¼‰': 'pyq_author',
    'æœ‹å‹åœˆï¼ˆä½œè€…æœ¬äººç‰ˆï¼‰': 'pyq_author',
    'æœ‹å‹åœˆæ–‡æ¡ˆï¼ˆä½œè€…æœ¬äººç‰ˆï¼‰': 'pyq_author',
    'æœ‹å‹åœˆæ–‡æ¡ˆï¼ˆè£ç¥è€å¸ˆæœ¬äººç‰ˆï¼‰': 'pyq_author',
    'æœ‹å‹åœˆï¼ˆè½¬å‘ç‰ˆï¼‰': 'pyq_assistant',
    'æœ‹å‹åœˆï¼ˆå°åŠ©æ‰‹/è½¬å‘ç‰ˆï¼‰': 'pyq_assistant',
    'æœ‹å‹åœˆæ–‡æ¡ˆï¼ˆå°åŠ©æ‰‹/è½¬å‘ç‰ˆï¼‰': 'pyq_assistant',
    'å°çº¢ä¹¦æ–‡æ¡ˆ': 'xiaohongshu',
    'å°çº¢ä¹¦å›¾æ–‡æ–‡æ¡ˆ': 'xiaohongshu',
    'å°çº¢ä¹¦æ ‡é¢˜': 'xhs_titles',
    'å°çº¢ä¹¦æ ‡é¢˜å¤‡é€‰': 'xhs_titles',
    'ç¤¾ç¾¤è½¬å‘è¯æœ¯': 'community',
    'ç§èŠæ¨èè¯æœ¯': 'private',
    'æ–‡ç« æ ‡é¢˜å¤‡é€‰': 'titles',
    'ç›®æ ‡äººç¾¤ç”»åƒ': 'audience',
    'é‡‘å¥å¡ç‰‡æ–‡æ¡ˆ': 'quotes',
    'çŸ­è§†é¢‘å£æ’­æ–‡æ¡ˆ': 'video',
    'è§†é¢‘å·/çŸ­è§†é¢‘å£æ’­æ–‡æ¡ˆ': 'video',
    'æ¬¡æ¡/è½¬è½½ç‰ˆ': 'secondary',
    'å…¬ä¼—å·æ¬¡æ¡/è½¬è½½ç‰ˆæ–‡æ¡ˆ': 'secondary',
    'SEOå…³é”®è¯': 'seo'
  };
  
  // è§£æå†…å®¹
  materials = {};
  const regex = /ã€([^ã€‘]+)ã€‘/g;
  const parts = text.split(regex);
  
  for (let i = 1; i < parts.length; i += 2) {
    const name = parts[i].trim();
    const content = (parts[i + 1] || '').trim();
    
    // æŸ¥æ‰¾åŒ¹é…çš„ID
    let id = null;
    for (const [key, value] of Object.entries(nameMap)) {
      if (name.includes(key.replace(/[ï¼ˆï¼‰]/g, '')) || key.includes(name)) {
        id = value;
        break;
      }
    }
    
    // æ¨¡ç³ŠåŒ¹é…
    if (!id) {
      if (name.includes('æœ‹å‹åœˆ') && (name.includes('ä½œè€…') || name.includes('æœ¬äºº'))) id = 'pyq_author';
      else if (name.includes('æœ‹å‹åœˆ') && (name.includes('è½¬å‘') || name.includes('åŠ©æ‰‹'))) id = 'pyq_assistant';
      else if (name.includes('å°çº¢ä¹¦') && name.includes('æ ‡é¢˜')) id = 'xhs_titles';
      else if (name.includes('å°çº¢ä¹¦')) id = 'xiaohongshu';
      else if (name.includes('ç¤¾ç¾¤')) id = 'community';
      else if (name.includes('ç§èŠ')) id = 'private';
      else if (name.includes('æ ‡é¢˜')) id = 'titles';
      else if (name.includes('äººç¾¤')) id = 'audience';
      else if (name.includes('é‡‘å¥')) id = 'quotes';
      else if (name.includes('è§†é¢‘') || name.includes('å£æ’­')) id = 'video';
      else if (name.includes('æ¬¡æ¡') || name.includes('è½¬è½½')) id = 'secondary';
      else if (name.includes('SEO') || name.includes('å…³é”®è¯')) id = 'seo';
    }
    
    if (id && content) {
      materials[id] = content;
    }
  }
  
  // æ›´æ–°å¡ç‰‡
  updateMaterialCards();
  
  const count = Object.keys(materials).length;
  if (count > 0) {
    showToast(`âœ… æˆåŠŸè§£æ ${count} ç§ç‰©æ–™`);
  } else {
    showToast('âš ï¸ æœªèƒ½è¯†åˆ«ç‰©æ–™æ ¼å¼ï¼Œè¯·æ£€æŸ¥AIè¿”å›çš„å†…å®¹æ˜¯å¦åŒ…å«ã€ç±»åˆ«åã€‘');
  }
}

function updateMaterialCards() {
  materialTypes.forEach(mt => {
    const el = document.getElementById('mat_' + mt.id);
    if (el) {
      if (materials[mt.id]) {
        el.textContent = materials[mt.id];
        el.classList.remove('empty');
      } else {
        el.textContent = 'ç­‰å¾…å¡«å……...';
        el.classList.add('empty');
      }
    }
  });
}

function clearMaterials() {
  document.getElementById('materialInputText').value = '';
  materials = {};
  updateMaterialCards();
  showToast('å·²æ¸…ç©º');
}

function copyMaterial(id) {
  const content = materials[id];
  if (content) {
    navigator.clipboard.writeText(content).then(() => showToast('âœ… å·²å¤åˆ¶'));
  } else {
    showToast('âš ï¸ è¯¥ç‰©æ–™è¿˜æœªå¡«å……');
  }
}

function copyAllMaterials() {
  let allText = '';
  materialTypes.forEach(mt => {
    if (materials[mt.id]) {
      allText += `ã€${mt.name}ã€‘\n${materials[mt.id]}\n\n`;
    }
  });
  
  if (allText) {
    navigator.clipboard.writeText(allText.trim()).then(() => showToast('âœ… æ‰€æœ‰ç‰©æ–™å·²å¤åˆ¶'));
  } else {
    showToast('âš ï¸ è¿˜æ²¡æœ‰ç‰©æ–™å†…å®¹');
  }
}

function exportMaterials() {
  let allText = `çŒ«é—¨æ™ºèƒ½æ’ç‰ˆå™¨ - è¥é”€ç‰©æ–™å¯¼å‡º\n${'='.repeat(40)}\n\n`;
  
  materialTypes.forEach(mt => {
    allText += `ã€${mt.name}ã€‘\n`;
    allText += `${materials[mt.id] || 'ï¼ˆæœªå¡«å……ï¼‰'}\n\n`;
  });
  
  const blob = new Blob([allText], { type: 'text/plain;charset=utf-8' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `è¥é”€ç‰©æ–™_${new Date().toLocaleDateString()}.txt`;
  a.click();
  URL.revokeObjectURL(url);
  
  showToast('âœ… å·²å¯¼å‡ºæ–‡ä»¶');
}

// ==================== å·¥å…·å‡½æ•° ====================
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2000);
}

function resetAll() {
  if (blocks.length && !confirm('ç¡®å®šæ¸…ç©ºæ‰€æœ‰å†…å®¹ï¼Ÿ')) return;
  blocks = [];
  materials = {};
  document.getElementById('inputText').value = '';
  document.getElementById('materialInputText').value = '';
  document.getElementById('inputCard').style.display = 'block';
  document.getElementById('editorSection').style.display = 'none';
  document.getElementById('materialPromptCard').style.display = 'none';
  document.getElementById('materialInputCard').style.display = 'none';
  document.getElementById('materialGrid').style.display = 'none';
  document.getElementById('materialActionsCard').style.display = 'none';
  renderBlocks();
  updatePreview();
  goToStep(1);
}

// ==================== äº‹ä»¶ç»‘å®š ====================
document.querySelectorAll('.color-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    currentScheme = btn.dataset.scheme;
    blocks.forEach(b => {
      if (b.type === 'imagePlaceholder' && b.content) {
        b.imgPrompt = generateImagePrompt(b.content, '');
      }
    });
    renderBlocks();
    updatePreview();
  });
});

document.querySelectorAll('.modal-overlay').forEach(o => {
  o.addEventListener('click', e => { if (e.target === o) o.classList.remove('show'); });
});

// åˆå§‹åŒ–
generatePrompt();
</script>

</body>
</html>
