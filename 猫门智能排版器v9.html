<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>çŒ«é—¨æ™ºèƒ½æ’ç‰ˆå™¨ v9</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:linear-gradient(135deg,#f7f5f3,#efe9e4);min-height:100vh;color:#333}
.container{max-width:1400px;margin:0 auto;padding:20px}
.header{text-align:center;padding:30px 0 20px}
.header h1{font-size:28px;color:#9b8b7d;margin-bottom:8px}
.header p{color:#888;font-size:14px}
.steps-bar{display:flex;justify-content:center;gap:8px;margin-bottom:30px;flex-wrap:wrap}
.step-tab{padding:12px 24px;background:#fff;border-radius:25px;cursor:pointer;border:2px solid transparent;transition:all .3s;font-size:14px;color:#666}
.step-tab:hover{border-color:#c4b5a5}
.step-tab.active{background:#9b8b7d;color:#fff;border-color:#9b8b7d}
.step-tab.done{background:#e8e0d8;color:#7a6f63;border-color:#c4b5a5}
.step-panel{display:none}
.step-panel.active{display:block}
.card{background:#fff;border-radius:16px;box-shadow:0 2px 12px rgba(0,0,0,.06);margin-bottom:20px;overflow:hidden}
.card-header{padding:18px 24px;border-bottom:1px solid #f0ebe6;display:flex;justify-content:space-between;align-items:center}
.card-title{font-size:16px;font-weight:600;color:#5a5a5a;display:flex;align-items:center;gap:8px}
.card-body{padding:24px}
.mode-cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px}
.mode-card{background:#faf8f6;border-radius:12px;padding:20px;cursor:pointer;border:2px solid transparent;transition:all .3s}
.mode-card:hover{border-color:#c4b5a5;transform:translateY(-2px)}
.mode-card.active{border-color:#9b8b7d;background:linear-gradient(135deg,#faf8f6,#f5f0eb)}
.mode-card h3{font-size:16px;color:#5a5a5a;margin-bottom:10px;display:flex;align-items:center;gap:8px}
.mode-card p{font-size:13px;color:#888;line-height:1.6}
.style-section{margin-top:24px}
.style-tabs{display:flex;gap:8px;margin-bottom:16px}
.style-tab{padding:8px 16px;background:#f5f0eb;border-radius:8px;cursor:pointer;font-size:13px;color:#666;border:none}
.style-tab.active{background:#9b8b7d;color:#fff}
.style-panel{display:none}
.style-panel.active{display:block}
.style-options{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:10px}
.style-option{padding:14px;background:#faf8f6;border-radius:10px;cursor:pointer;border:2px solid transparent;transition:all .2s;text-align:center}
.style-option:hover{border-color:#c4b5a5}
.style-option.active{border-color:#9b8b7d;background:#f5f0eb}
.style-option h4{font-size:14px;color:#5a5a5a;margin-bottom:4px}
.style-option p{font-size:11px;color:#999}
.hidden{display:none!important}
.nav-row{display:flex;justify-content:space-between;margin-top:20px;flex-wrap:wrap;gap:10px}
.btn{padding:12px 28px;border-radius:25px;border:none;cursor:pointer;font-size:14px;font-weight:500;transition:all .3s;display:inline-flex;align-items:center;gap:6px}
.btn-primary{background:#9b8b7d;color:#fff}
.btn-primary:hover{background:#8a7a6c;transform:translateY(-1px)}
.btn-secondary{background:#f5f0eb;color:#666}
.btn-secondary:hover{background:#ebe4dc}
.btn-outline{background:transparent;border:1px solid #c4b5a5;color:#666}
.btn-outline:hover{background:#faf8f6}
.btn-accent{background:#c4b5a5;color:#fff}
.btn-accent:hover{background:#b5a596}
.btn-sm{padding:8px 16px;font-size:12px}
.textarea-box{width:100%;min-height:200px;padding:16px;border:1px solid #e8e0d8;border-radius:12px;font-size:14px;line-height:1.8;resize:vertical;font-family:inherit}
.textarea-box:focus{outline:none;border-color:#9b8b7d}
.textarea-footer{display:flex;justify-content:space-between;align-items:center;margin-top:12px;flex-wrap:wrap;gap:10px}
.prompt-box{background:#faf8f6;border-radius:12px;padding:20px;margin-top:16px;position:relative}
.prompt-box pre{white-space:pre-wrap;word-break:break-word;font-size:13px;line-height:1.8;color:#555;max-height:400px;overflow-y:auto;font-family:inherit}
.prompt-actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:16px}
.ai-buttons{display:flex;flex-wrap:wrap;gap:8px;margin-top:16px;padding-top:16px;border-top:1px solid #e8e0d8}
.ai-btn{padding:10px 18px;border-radius:20px;border:1px solid #e8e0d8;background:#fff;cursor:pointer;font-size:13px;display:flex;align-items:center;gap:6px;transition:all .2s}
.ai-btn:hover{border-color:#9b8b7d;background:#faf8f6}
.editor-layout{display:grid;grid-template-columns:1fr 375px;gap:20px;margin-top:20px}
@media(max-width:900px){.editor-layout{grid-template-columns:1fr}}
.full-article-editor{background:#fff;border-radius:16px;box-shadow:0 2px 12px rgba(0,0,0,.06);margin-bottom:20px;overflow:hidden}
.full-article-header{padding:16px 20px;border-bottom:1px solid #f0ebe6;display:flex;justify-content:space-between;align-items:center}
.full-article-title{font-size:14px;font-weight:600;color:#5a5a5a}
.full-article-textarea{width:100%;min-height:300px;padding:20px;border:none;font-size:14px;line-height:2;resize:vertical;font-family:inherit}
.full-article-textarea:focus{outline:none}
.blocks-list{max-height:500px;overflow-y:auto;padding:16px}
.block-item{background:#faf8f6;border-radius:10px;margin-bottom:12px;overflow:hidden}
.block-head{display:flex;justify-content:space-between;align-items:center;padding:10px 14px;background:#f5f0eb}
.block-type-sel{padding:4px 8px;border:1px solid #d4c8bc;border-radius:6px;font-size:12px;background:#fff}
.block-actions{display:flex;gap:4px}
.block-act-btn{width:26px;height:26px;border:none;background:#fff;border-radius:6px;cursor:pointer;font-size:12px;color:#666}
.block-act-btn:hover{background:#9b8b7d;color:#fff}
.block-act-btn.del:hover{background:#e74c3c}
.block-act-btn.img{background:#e8f4e8;color:#5d8a66}
.block-act-btn.img:hover{background:#5d8a66;color:#fff}
.block-body{padding:12px 14px}
.block-input{width:100%;padding:10px;border:1px solid #e8e0d8;border-radius:8px;font-size:13px;line-height:1.6;resize:vertical;min-height:60px;font-family:inherit}
.block-input:focus{outline:none;border-color:#9b8b7d}
.divider-preview{text-align:center;color:#c4b5a5;letter-spacing:8px;padding:10px}
.img-placeholder{text-align:center;padding:16px;background:#fff;border-radius:8px;border:1px dashed #c4b5a5}
.img-placeholder-text{color:#888;font-size:13px;margin-bottom:8px}
.img-placeholder-prompt{font-size:11px;color:#5d8a66;background:#e8f4e8;padding:8px 12px;border-radius:6px;margin:8px 0;text-align:left;word-break:break-word}
.img-placeholder-actions{display:flex;gap:8px;justify-content:center;margin-top:8px}
.phone-wrap{position:sticky;top:20px}
.phone-frame{background:#1a1a1a;border-radius:40px;padding:12px;box-shadow:0 10px 40px rgba(0,0,0,.15)}
.phone-screen{background:#fff;border-radius:32px;overflow:hidden}
.phone-top{display:flex;justify-content:space-between;padding:12px 20px;font-size:12px;color:#999;border-bottom:1px solid #f0f0f0}
.phone-content{height:500px;overflow-y:auto;padding:20px}
.phone-bottom{display:flex;justify-content:center;gap:10px;padding:12px;border-top:1px solid #f0f0f0}
.add-blocks{display:flex;flex-wrap:wrap;gap:8px;padding:16px}
.add-block-btn{padding:8px 14px;background:#fff;border:1px dashed #c4b5a5;border-radius:8px;cursor:pointer;font-size:12px;color:#888}
.add-block-btn:hover{border-color:#9b8b7d;color:#9b8b7d}
.color-bar{display:flex;align-items:center;gap:10px;padding:12px 16px;background:#f5f0eb}
.color-label{font-size:12px;color:#888}
.color-options{display:flex;gap:6px}
.color-btn{width:24px;height:24px;border-radius:50%;border:2px solid transparent;cursor:pointer}
.color-btn.active{border-color:#333;box-shadow:0 0 0 2px #fff,0 0 0 4px #333}
.materials-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:16px}
.material-card{background:#faf8f6;border-radius:12px;padding:16px;border:1px solid #e8e0d8}
.material-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.material-title{font-size:14px;font-weight:600;color:#5a5a5a;display:flex;align-items:center;gap:6px}
.material-content{font-size:13px;color:#666;line-height:1.8;max-height:150px;overflow-y:auto}
.material-content textarea{width:100%;min-height:100px;padding:10px;border:1px solid #e8e0d8;border-radius:8px;font-size:13px;line-height:1.6;resize:vertical;font-family:inherit}
.image-prompts-card{margin-top:20px}
.image-prompt-item{background:#fff;border-radius:10px;padding:14px;margin-bottom:12px;border:1px solid #e8e0d8}
.image-prompt-title{font-size:13px;font-weight:600;color:#5a5a5a;margin-bottom:8px}
.image-prompt-text{font-size:12px;color:#666;line-height:1.6;word-break:break-word}
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;justify-content:center;align-items:center;z-index:1000}
.modal-overlay.show{display:flex}
.modal{background:#fff;border-radius:20px;padding:30px;max-width:500px;width:90%;max-height:90vh;overflow-y:auto}
.modal h3{font-size:18px;color:#5a5a5a;margin-bottom:20px}
.modal input[type="text"]{width:100%;padding:12px;border:1px solid #e8e0d8;border-radius:10px;font-size:14px;margin-bottom:12px}
.modal input[type="text"]:focus{outline:none;border-color:#9b8b7d}
.modal-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:20px}
.toast{position:fixed;bottom:30px;left:50%;transform:translateX(-50%);background:#333;color:#fff;padding:12px 24px;border-radius:25px;font-size:14px;z-index:2000;opacity:0;transition:opacity .3s}
.toast.show{opacity:1}
.length-section{margin-top:16px;padding:16px;background:#f5f0eb;border-radius:12px}
.length-label{font-size:13px;color:#666;margin-bottom:10px;display:block}
.length-options{display:flex;gap:8px;flex-wrap:wrap}
.length-btn{padding:8px 16px;border-radius:20px;border:1px solid #d4c8bc;background:#fff;cursor:pointer;font-size:13px;color:#666;transition:all .2s}
.length-btn:hover{border-color:#9b8b7d}
.length-btn.active{background:#9b8b7d;color:#fff;border-color:#9b8b7d}
</style>
</head>
<body>
<div class="container">
<div class="header"><h1>ğŸ± çŒ«é—¨æ™ºèƒ½æ’ç‰ˆå™¨</h1><p>v9 Â· è®©å…¬ä¼—å·æ’ç‰ˆä¼˜é›…é«˜æ•ˆ</p></div>
<div class="steps-bar">
<div class="step-tab active" data-step="1" onclick="goToStep(1)">â‘  é€‰æ‹©æ¨¡å¼</div>
<div class="step-tab" data-step="2" onclick="goToStep(2)">â‘¡ ç”Ÿæˆæç¤ºè¯</div>
<div class="step-tab" data-step="3" onclick="goToStep(3)">â‘¢ ç¼–è¾‘æ’ç‰ˆ</div>
<div class="step-tab" data-step="4" onclick="goToStep(4)">â‘£ è¥é”€ç‰©æ–™</div>
</div>

<div class="step-panel active" data-step="1">
<div class="card"><div class="card-header"><div class="card-title">ğŸ¯ é€‰æ‹©ä½ çš„åˆ›ä½œæ¨¡å¼</div></div><div class="card-body">
<div class="mode-cards">
<div class="mode-card active" data-mode="A" onclick="selectMode('A')"><h3>ğŸ“ æ¨¡å¼Aï¼šå·²æœ‰æ–‡ç« </h3><p>æˆ‘å·²ç»å†™å¥½äº†ä¸€ç¯‡æ–‡ç« ï¼Œæƒ³è®©AIå¸®æˆ‘ä¼˜åŒ–æ’ç‰ˆã€æ‰¾å‡ºé‡‘å¥ã€æ·»åŠ é…å›¾å»ºè®®</p></div>
<div class="mode-card" data-mode="B" onclick="selectMode('B')"><h3>ğŸ’¡ æ¨¡å¼Bï¼šä¸»é¢˜åˆ›ä½œ</h3><p>æˆ‘æœ‰ä¸€ä¸ªä¸»é¢˜æˆ–æƒ³æ³•ï¼Œæƒ³è®©AIå¸®æˆ‘ä»é›¶å†™ä¸€ç¯‡çˆ†æ¬¾æ–‡ç« </p></div>
<div class="mode-card" data-mode="C" onclick="selectMode('C')"><h3>ğŸ“š æ¨¡å¼Cï¼šé•¿ç´ ææç‚¼</h3><p>æˆ‘æœ‰é€å­—ç¨¿/ç¬”è®°ç­‰é•¿ç´ æï¼Œæƒ³è®©AIå¸®æˆ‘æç‚¼æˆç²¾åæ–‡ç« </p></div>
<div class="mode-card" data-mode="D" onclick="selectMode('D')"><h3>ğŸ§© æ¨¡å¼Dï¼šç´ ææ•´åˆ</h3><p>æˆ‘æ”¶é›†äº†å¤šä¸ªç´ æç‰‡æ®µï¼Œæƒ³è®©AIå¸®æˆ‘æ•´åˆæˆä¸€ç¯‡åŸåˆ›æ–‡ç« </p></div>
</div>
<div id="styleSection" class="style-section hidden">
<div class="style-tabs">
<div class="style-tab active" data-tab="preset" onclick="switchStyleTab('preset')">é¢„è®¾é£æ ¼</div>
<div class="style-tab" data-tab="custom" onclick="switchStyleTab('custom')">è‡ªå®šä¹‰é£æ ¼</div>
</div>
<div class="style-panel active" data-panel="preset">
<div class="style-options">
<div class="style-option active" data-style="catgate" onclick="selectStyle('catgate')"><h4>ğŸ± çŒ«é—¨é£æ ¼</h4><p>ä¸“ä¸šæœ‰æ·±åº¦ä½†ä¸æ™¦æ¶©</p></div>
<div class="style-option" data-style="lemon" onclick="selectStyle('lemon')"><h4>ğŸ‹ æŸ æª¬å¿ƒç†</h4><p>è½»æ¾æ´»æ³¼ã€å¹´è½»åŒ–</p></div>
<div class="style-option" data-style="healing" onclick="selectStyle('healing')"><h4>ğŸŒ¿ æ²»æ„ˆç³»</h4><p>æ¸©æš–æ²»æ„ˆã€å…±æƒ…æ„Ÿå¼º</p></div>
<div class="style-option" data-style="hardcore" onclick="selectStyle('hardcore')"><h4>ğŸ’ª ç¡¬æ ¸å¹²è´§</h4><p>ä¿¡æ¯å¯†é›†ã€ä¸“ä¸šæ·±åº¦</p></div>
<div class="style-option" data-style="story" onclick="selectStyle('story')"><h4>ğŸ“– æ•…äº‹é©±åŠ¨</h4><p>æ¡ˆä¾‹ä¸°å¯Œã€å™äº‹æ„Ÿå¼º</p></div>
<div class="style-option" data-style="mimeng" onclick="selectStyle('mimeng')"><h4>âš¡ æƒ…ç»ªå¼ åŠ›</h4><p>è§‚ç‚¹çŠ€åˆ©ã€çŸ­å¥ä¸ºä¸»</p></div>
<div class="style-option" data-style="kaizhi" onclick="selectStyle('kaizhi')"><h4>ğŸ§  è®¤çŸ¥ç§‘å­¦</h4><p>å­¦æœ¯åº•è•´ã€é€»è¾‘ä¸¥å¯†</p></div>
<div class="style-option" data-style="zhihu" onclick="selectStyle('zhihu')"><h4>ğŸ” çŸ¥ä¹ä½“</h4><p>è®ºæ®å……åˆ†ã€ç»“æ„åŒ–å¼º</p></div>
<div class="style-option" data-style="lifestyle" onclick="selectStyle('lifestyle')"><h4>âœ¨ ç”Ÿæ´»ç¾å­¦</h4><p>ç²¾è‡´æœ‰å“å‘³ã€ä¸è¯´æ•™</p></div>
</div>
</div>
<div class="style-panel hidden" data-panel="custom">
<textarea class="textarea-box" id="customStyleInput" placeholder="æè¿°ä½ æƒ³è¦çš„å†™ä½œé£æ ¼ï¼Œä¾‹å¦‚ï¼šåƒå’Œè€æœ‹å‹èŠå¤©ä¸€æ ·è‡ªç„¶ï¼Œæœ‰æ´å¯Ÿä½†ä¸è¯´æ•™ï¼Œé€‚å½“ç”¨æ¯”å–»è®©æŠ½è±¡æ¦‚å¿µæ›´æ˜“æ‡‚..." style="min-height:120px"></textarea>
</div>
<div id="lengthSection" class="length-section">
<label class="length-label">ğŸ“ æ–‡ç« é•¿åº¦</label>
<div class="length-options">
<button class="length-btn" data-len="short" onclick="selectLength('short')">çŸ­æ–‡ 800-1200å­—</button>
<button class="length-btn active" data-len="medium" onclick="selectLength('medium')">ä¸­ç­‰ 1500-2500å­—</button>
<button class="length-btn" data-len="long" onclick="selectLength('long')">é•¿æ–‡ 3000-4000å­—</button>
<button class="length-btn" data-len="auto" onclick="selectLength('auto')">è‡ªåŠ¨åˆ¤æ–­</button>
</div>
</div>
</div>
</div></div>
<div class="nav-row"><div></div><button class="btn btn-primary" onclick="goToStep(2)">ä¸‹ä¸€æ­¥ï¼šç”Ÿæˆæç¤ºè¯ â†’</button></div>
</div>

<div class="step-panel" data-step="2">
<div class="card"><div class="card-header"><div class="card-title">ğŸ“‹ <span id="materialInputDesc">æŠŠä½ å·²å†™å¥½çš„æ–‡ç« ç²˜è´´åˆ°ä¸‹æ–¹</span></div></div><div class="card-body">
<textarea class="textarea-box" id="userMaterialInput" placeholder="åœ¨è¿™é‡Œç²˜è´´ä½ å·²å†™å¥½çš„å®Œæ•´æ–‡ç« ..." oninput="updateMaterialWordCount()"></textarea>
<div class="textarea-footer"><span id="materialWordCount">0 å­—</span><button class="btn btn-primary btn-sm" onclick="saveMaterialInput()">ä¿å­˜</button><button class="btn btn-secondary btn-sm" onclick="clearMaterialInput()">æ¸…ç©º</button></div>
</div></div>
<div class="card"><div class="card-header"><div class="card-title">âœ¨ AIæç¤ºè¯</div><button class="btn btn-sm btn-outline" onclick="copyPrompt()">ğŸ“‹ å¤åˆ¶</button></div><div class="card-body">
<div class="prompt-box"><pre id="promptText">æç¤ºè¯å°†åœ¨è¿™é‡Œç”Ÿæˆ...</pre></div>
<div class="ai-buttons">
<button class="ai-btn" onclick="copyAndJump('https://claude.ai')">ğŸ¤– Claude</button>
<button class="ai-btn" onclick="copyAndJump('https://chat.openai.com')">ğŸ’¬ ChatGPT</button>
<button class="ai-btn" onclick="copyAndJump('https://gemini.google.com/')">âœ¨ Gemini</button>
<button class="ai-btn" onclick="copyAndJump('https://kimi.moonshot.cn')">ğŸŒ™ Kimi</button>
<button class="ai-btn" onclick="copyAndJump('https://www.doubao.com/chat/')">ğŸ”¥ è±†åŒ…</button>
</div>
</div></div>
<div class="nav-row"><button class="btn btn-secondary" onclick="goToStep(1)">â† è¿”å›é€‰æ‹©</button><button class="btn btn-primary" onclick="goToStep(3)">ä¸‹ä¸€æ­¥ï¼šç¼–è¾‘æ’ç‰ˆ â†’</button></div>
</div>

<div class="step-panel" data-step="3">
<div class="card" id="inputCard"><div class="card-header"><div class="card-title">ğŸ“¥ ç²˜è´´AIè¿”å›çš„å†…å®¹</div></div><div class="card-body">
<textarea class="textarea-box" id="inputText" placeholder="æŠŠAIç”Ÿæˆçš„å®Œæ•´å†…å®¹ç²˜è´´åˆ°è¿™é‡Œï¼ˆåŒ…æ‹¬æ–‡ç« å’Œé…å›¾æç¤ºè¯ï¼‰..." oninput="updateWordCount()"></textarea>
<div class="textarea-footer"><span id="wordCount">0 å­—</span><button class="btn btn-accent" onclick="parseContent()">ğŸš€ æ™ºèƒ½è§£æ</button></div>
</div></div>
<div class="editor-layout" id="editorSection" style="display:none">
<div>
<div class="full-article-editor"><div class="full-article-header"><div class="full-article-title">ğŸ“ å®Œæ•´æ–‡ç« ï¼ˆå¯ç›´æ¥ç¼–è¾‘ï¼‰</div><button class="btn btn-sm btn-outline" onclick="syncFromFullArticle()">åŒæ­¥åˆ°æ¨¡å—</button></div><textarea class="full-article-textarea" id="fullArticleText" oninput="onFullArticleInput()" placeholder="åœ¨è¿™é‡Œç¼–è¾‘å®Œæ•´æ–‡ç« ..."></textarea></div>
<div class="card"><div class="card-header"><div class="card-title">ğŸ“¦ å†…å®¹æ¨¡å— <span id="blockCount">(0)</span></div><button class="btn btn-sm btn-outline" onclick="showInputCard()">é‡æ–°ç²˜è´´</button></div>
<div class="blocks-list" id="blocksList"></div>
<div class="add-blocks">
<button class="add-block-btn" onclick="addBlock('paragraph')">+ æ®µè½</button>
<button class="add-block-btn" onclick="addBlock('quote')">+ é‡‘å¥</button>
<button class="add-block-btn" onclick="addBlock('heading')">+ æ ‡é¢˜</button>
<button class="add-block-btn" onclick="addBlock('divider')">+ åˆ†å‰²çº¿</button>
<button class="add-block-btn" onclick="addBlock('list')">+ åˆ—è¡¨</button>
<button class="add-block-btn" onclick="addBlock('imagePlaceholder')">+ å›¾ç‰‡</button>
</div>
<div class="color-bar"><span class="color-label">é…è‰²ï¼š</span><div class="color-options">
<button class="color-btn active" data-scheme="morandi" style="background:linear-gradient(135deg,#9b8b7d,#c4b5a5)" title="è«å…°è¿ª"></button>
<button class="color-btn" data-scheme="green" style="background:linear-gradient(135deg,#5d8a66,#7eb085)" title="æ£®ç»¿"></button>
<button class="color-btn" data-scheme="purple" style="background:linear-gradient(135deg,#8b7eb8,#a99cd1)" title="è–°è¡£è‰"></button>
<button class="color-btn" data-scheme="milktea" style="background:linear-gradient(135deg,#a67c52,#c9a77c)" title="å¥¶èŒ¶"></button>
<button class="color-btn" data-scheme="blackgold" style="background:linear-gradient(135deg,#333,#c9a962)" title="é»‘é‡‘"></button>
<button class="color-btn" data-scheme="coral" style="background:linear-gradient(135deg,#e07a5f,#f2a07b)" title="çŠç‘š"></button>
</div></div>
</div>
</div>
<div class="phone-wrap"><div class="phone-frame"><div class="phone-screen"><div class="phone-top"><span>é¢„è§ˆæ•ˆæœ</span><span>çŒ«é—¨</span></div><div class="phone-content" id="previewContent"><div style="text-align:center;color:#999;padding:40px">é¢„è§ˆå†…å®¹</div></div><div class="phone-bottom"><button class="btn btn-secondary btn-sm" onclick="copyAllCode()">å¤åˆ¶ä»£ç </button><button class="btn btn-primary btn-sm" onclick="goToStep(4)">è¥é”€ç‰©æ–™</button></div></div></div></div>
</div>
<div class="nav-row"><button class="btn btn-secondary" onclick="goToStep(2)">â† è¿”å›æç¤ºè¯</button><button class="btn btn-primary" onclick="goToStep(4)">ä¸‹ä¸€æ­¥ï¼šè¥é”€ç‰©æ–™ â†’</button></div>
</div>

<div class="step-panel" data-step="4">
<div class="card"><div class="card-header"><div class="card-title">ğŸ“¢ è¥é”€ç‰©æ–™ç”Ÿæˆ</div><button class="btn btn-sm btn-accent" onclick="generateMaterials()">ğŸš€ ç”Ÿæˆå…¨éƒ¨ç‰©æ–™</button></div><div class="card-body">
<div class="prompt-box"><pre id="materialsPrompt">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®ç”Ÿæˆè¥é”€ç‰©æ–™æç¤ºè¯...</pre></div>
<div class="ai-buttons">
<button class="ai-btn" onclick="copyMaterialsPrompt()">ğŸ“‹ å¤åˆ¶æç¤ºè¯</button>
<button class="ai-btn" onclick="copyMaterialsAndJump('https://claude.ai')">ğŸ¤– Claude</button>
<button class="ai-btn" onclick="copyMaterialsAndJump('https://chat.openai.com')">ğŸ’¬ ChatGPT</button>
<button class="ai-btn" onclick="copyMaterialsAndJump('https://gemini.google.com/')">âœ¨ Gemini</button>
</div>
</div></div>
<div class="card"><div class="card-header"><div class="card-title">ğŸ“ ç‰©æ–™ç»“æœï¼ˆç²˜è´´AIè¿”å›çš„å†…å®¹ï¼‰</div><button class="btn btn-sm btn-outline" onclick="parseMaterials()">è§£æç‰©æ–™</button></div><div class="card-body">
<textarea class="textarea-box" id="materialsInput" placeholder="æŠŠAIç”Ÿæˆçš„è¥é”€ç‰©æ–™ç²˜è´´åˆ°è¿™é‡Œ..."></textarea>
</div></div>
<div class="materials-grid" id="materialsGrid"></div>
<div class="card image-prompts-card" id="imagePromptsCard" style="display:none"><div class="card-header"><div class="card-title">ğŸ–¼ï¸ é…å›¾æç¤ºè¯</div></div><div class="card-body">
<div class="image-prompt-item"><div class="image-prompt-title">å…¬ä¼—å·å°é¢å›¾ (2.35:1æ¨ªç‰ˆ)</div><div class="image-prompt-text" id="coverImagePrompt">è§£æåæ˜¾ç¤º</div><button class="btn btn-sm btn-outline" style="margin-top:8px" onclick="copyImagePrompt('cover')">å¤åˆ¶</button></div>
<div class="image-prompt-item"><div class="image-prompt-title">å°çº¢ä¹¦å°é¢å›¾ (3:4ç«–ç‰ˆ)</div><div class="image-prompt-text" id="xhsCoverImagePrompt">è§£æåæ˜¾ç¤º</div><button class="btn btn-sm btn-outline" style="margin-top:8px" onclick="copyImagePrompt('xhsCover')">å¤åˆ¶</button></div>
<div class="image-prompt-item"><div class="image-prompt-title">æœ‹å‹åœˆé…å›¾ (1:1æ–¹å½¢)</div><div class="image-prompt-text" id="socialImagePrompt">è§£æåæ˜¾ç¤º</div><button class="btn btn-sm btn-outline" style="margin-top:8px" onclick="copyImagePrompt('social')">å¤åˆ¶</button></div>
<div class="image-prompt-item"><div class="image-prompt-title">é‡‘å¥å¡ç‰‡èƒŒæ™¯</div><div class="image-prompt-text" id="quoteCardImagePrompt">è§£æåæ˜¾ç¤º</div><button class="btn btn-sm btn-outline" style="margin-top:8px" onclick="copyImagePrompt('quoteCard')">å¤åˆ¶</button></div>
</div></div>
<div class="nav-row"><button class="btn btn-secondary" onclick="goToStep(3)">â† è¿”å›ç¼–è¾‘</button><button class="btn btn-primary" onclick="exportAll()">ğŸ“¥ å¯¼å‡ºå…¨éƒ¨</button></div>
</div>
</div>

<div class="modal-overlay" id="imageModal">
<div class="modal"><h3>ğŸ–¼ï¸ æ·»åŠ å›¾ç‰‡</h3>
<input type="text" id="imageUrlInput" placeholder="ç²˜è´´å›¾ç‰‡URLï¼Œæˆ–ä¸Šä¼ å›¾ç‰‡åè‡ªåŠ¨å¡«å…¥">
<input type="file" accept="image/*" onchange="handleImageUpload(event)" style="margin-top:8px">
<div class="modal-actions"><button class="btn btn-secondary" onclick="closeImageModal()">å–æ¶ˆ</button><button class="btn btn-primary" onclick="confirmImage()">ç¡®è®¤</button></div>
</div>
</div>

<div class="toast" id="toast"></div>

<script>
let currentStep=1,currentMode='A',currentStyleTab='preset',currentStyle='catgate',currentScheme='morandi',currentLength='medium',blocks=[],editingImageIndex=null,materials={},imagePrompts={},fullArticleSyncTimeout=null;

const schemes={morandi:{primary:'#9b8b7d',text:'#5a5a5a',textLight:'#777',bgWarm:'#f7f5f3',bgWarmEnd:'#efe9e4',bgCard:'#f7f5f3',border:'#c4b5a5'},green:{primary:'#5d8a66',text:'#3d4a3f',textLight:'#666',bgWarm:'#f4f9f5',bgWarmEnd:'#e8f2ea',bgCard:'#f4f9f5',border:'#7eb085'},purple:{primary:'#8b7eb8',text:'#4a4558',textLight:'#666',bgWarm:'#f8f6fc',bgWarmEnd:'#f0ecf8',bgCard:'#f8f6fc',border:'#a99cd1'},milktea:{primary:'#a67c52',text:'#4d4035',textLight:'#6d5d4d',bgWarm:'#faf6f1',bgWarmEnd:'#f5ebe0',bgCard:'#faf6f1',border:'#c9a77c'},blackgold:{primary:'#c9a962',text:'#333',textLight:'#555',bgWarm:'#f9f8f5',bgWarmEnd:'#f3f0e8',bgCard:'#f9f8f5',border:'#c9a962'},coral:{primary:'#e07a5f',text:'#4a4a4a',textLight:'#666',bgWarm:'#fef7f5',bgWarmEnd:'#fceee9',bgCard:'#fef7f5',border:'#f2a07b'}};

const blockTypeNames={paragraph:'æ®µè½',emphasis:'å¼ºè°ƒ',quote:'é‡‘å¥',heading:'æ ‡é¢˜',list:'åˆ—è¡¨',divider:'åˆ†å‰²çº¿',image:'å›¾ç‰‡',imagePlaceholder:'å›¾ç‰‡å»ºè®®'};

const styleDescriptions={catgate:'ä¸“ä¸šæœ‰æ·±åº¦ä½†ä¸æ™¦æ¶©ï¼Œåƒä¸€ä½å€¼å¾—ä¿¡èµ–çš„æœ‹å‹åœ¨åˆ†äº«è§è§£ã€‚æœ‰å¿ƒç†å­¦ä¸“ä¸šåº•è•´ï¼Œå–„äºç”¨æ—¥å¸¸ä¾‹å­è§£é‡Šå¤æ‚æ¦‚å¿µï¼Œè®©è¯»è€…æ—¢æœ‰æ”¶è·æ„Ÿåˆè§‰å¾—äº²åˆ‡ã€‚é‡‘å¥æœ‰æ´å¯ŸåŠ›ï¼Œèƒ½è®©äººã€ŒåŸæ¥å¦‚æ­¤ã€ã€‚',lemon:'è½»æ¾æ´»æ³¼ã€å¹´è½»åŒ–ã€æœ‰è¶£å‘³ï¼Œåƒå’Œå¥½æœ‹å‹èŠå¤©ä¸€æ ·è‡ªç„¶ã€‚å–„ç”¨æ¯”å–»ã€ç±»æ¯”å’Œç½‘ç»œç”¨è¯­ï¼Œè®©ä¸“ä¸šå†…å®¹ä¹Ÿå˜å¾—å¹³æ˜“è¿‘äººã€‚',healing:'æ¸©æš–æ²»æ„ˆã€å…±æƒ…æ„Ÿå¼ºã€æƒ…æ„Ÿå‘ã€‚åƒä¸€æ¯çƒ­å¯å¯ï¼Œè®©è¯»è€…æ„Ÿåˆ°è¢«ç†è§£å’ŒæŠšæ…°ã€‚å–„äºæ•æ‰ç»†è…»çš„æƒ…æ„Ÿï¼Œæ–‡å­—æœ‰ç–—æ„ˆåŠ›é‡ã€‚',hardcore:'ç¡¬æ ¸å¹²è´§ã€ä¸“ä¸šæ·±åº¦ã€ä¿¡æ¯å¯†é›†ã€‚é€»è¾‘ä¸¥è°¨ï¼Œè®ºæ®æ‰å®ï¼Œé€‚åˆæƒ³æ·±å…¥å­¦ä¹ çš„è¯»è€…ã€‚æ¯ä¸€æ®µéƒ½æœ‰å®æ‰“å®çš„çŸ¥è¯†ç‚¹ã€‚',story:'æ•…äº‹é©±åŠ¨ã€æ¡ˆä¾‹ä¸°å¯Œã€å™äº‹æ„Ÿå¼ºã€‚ç”¨çœŸå®æˆ–å…¸å‹çš„æ•…äº‹æ¥ä¼ é€’è§‚ç‚¹ï¼Œè®©è¯»è€…åœ¨æ•…äº‹ä¸­è‡ªç„¶é¢†æ‚Ÿã€‚',mimeng:'æƒ…ç»ªå¼ åŠ›å¼ºã€è§‚ç‚¹çŠ€åˆ©ã€çŸ­å¥ä¸ºä¸»ã€‚æ¯ä¸€å¥éƒ½æœ‰å†²å‡»åŠ›ï¼Œè®©è¯»è€…å¿ä¸ä½ç‚¹å¤´æˆ–è½¬å‘ã€‚å–„ç”¨å¯¹æ¯”ã€åè½¬ã€æ‚¬å¿µã€‚',kaizhi:'è®¤çŸ¥ç§‘å­¦è§†è§’ã€ä¿¡æ¯å¯†åº¦é«˜ã€æœ‰å­¦æœ¯åº•è•´ã€é€»è¾‘ä¸¥å¯†ã€‚å¼•ç”¨ç ”ç©¶å’Œç†è®ºï¼Œä½†è¡¨è¾¾æ¸…æ™°æ˜“æ‡‚ï¼Œé€‚åˆæ±‚çŸ¥æ¬²å¼ºçš„è¯»è€…ã€‚',zhihu:'é€»è¾‘æ¸…æ™°ã€è®ºæ®å……åˆ†ã€ä¸“ä¸šå¯ä¿¡ã€ç»“æ„åŒ–å¼ºã€‚åƒä¸€ç¯‡ç²¾å¿ƒç»„ç»‡çš„å›ç­”ï¼Œå…ˆæŠ›ç»“è®ºå†å±•å¼€è®ºè¯ã€‚',lifestyle:'ç²¾è‡´ç¾å­¦ã€æœ‰å“å‘³ã€ä¸è¯´æ•™ã€ç”Ÿæ´»åŒ–ã€‚æ–‡å­—æœ‰è´¨æ„Ÿï¼Œä¼ é€’ä¸€ç§ç†æƒ³ç”Ÿæ´»çš„å‘å¾€ï¼Œè®©äººå¿ƒç”Ÿå‘å¾€ã€‚'};

const materialTypes=[{id:'pyq_author',name:'æœ‹å‹åœˆï¼ˆä½œè€…ç‰ˆï¼‰',icon:'ğŸ“±'},{id:'pyq_assistant',name:'æœ‹å‹åœˆï¼ˆè½¬å‘ç‰ˆï¼‰',icon:'ğŸ“±'},{id:'xiaohongshu',name:'å°çº¢ä¹¦æ–‡æ¡ˆ',icon:'ğŸ“•'},{id:'xhs_titles',name:'å°çº¢ä¹¦æ ‡é¢˜',icon:'ğŸ“•'},{id:'community',name:'ç¤¾ç¾¤è½¬å‘è¯æœ¯',icon:'ğŸ‘¥'},{id:'private',name:'ç§èŠæ¨èè¯æœ¯',icon:'ğŸ’¬'},{id:'titles',name:'æ–‡ç« æ ‡é¢˜å¤‡é€‰',icon:'ğŸ“°'},{id:'audience',name:'ç›®æ ‡äººç¾¤ç”»åƒ',icon:'ğŸ¯'},{id:'quotes',name:'é‡‘å¥å¡ç‰‡æ–‡æ¡ˆ',icon:'ğŸ’'},{id:'video',name:'çŸ­è§†é¢‘å£æ’­æ–‡æ¡ˆ',icon:'ğŸ¬'},{id:'secondary',name:'æ¬¡æ¡/è½¬è½½ç‰ˆ',icon:'ğŸ“„'},{id:'seo',name:'SEOå…³é”®è¯',icon:'ğŸ”'}];

function showToast(msg){const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2500)}

function goToStep(step){
  if(step===2){generatePrompt();updateMaterialInputDesc()}
  if(step===4&&blocks.length>0){document.getElementById('imagePromptsCard').style.display='block'}
  currentStep=step;
  document.querySelectorAll('.step-panel').forEach(p=>p.classList.remove('active'));
  document.querySelector('.step-panel[data-step="'+step+'"]').classList.add('active');
  document.querySelectorAll('.step-tab').forEach(t=>{
    t.classList.remove('active','done');
    const s=parseInt(t.dataset.step);
    if(s<step)t.classList.add('done');
    if(s===step)t.classList.add('active');
  });
  window.scrollTo({top:0,behavior:'smooth'});
}

function selectMode(mode){
  currentMode=mode;
  document.querySelectorAll('.mode-card').forEach(c=>c.classList.toggle('active',c.dataset.mode===mode));
  document.getElementById('styleSection').classList.toggle('hidden',mode==='A');
}

function switchStyleTab(tab){
  currentStyleTab=tab;
  document.querySelectorAll('.style-tab').forEach(t=>t.classList.toggle('active',t.dataset.tab===tab));
  document.querySelectorAll('.style-panel').forEach(p=>p.classList.toggle('hidden',p.dataset.panel!==tab));
}

function selectStyle(style){
  currentStyle=style;
  document.querySelectorAll('.style-option').forEach(o=>o.classList.toggle('active',o.dataset.style===style));
}

function selectLength(len){
  currentLength=len;
  document.querySelectorAll('.length-btn').forEach(b=>b.classList.toggle('active',b.dataset.len===len));
}

function updateMaterialInputDesc(){
  const desc=document.getElementById('materialInputDesc'),input=document.getElementById('userMaterialInput');
  const placeholders={
    A:['æŠŠä½ å·²å†™å¥½çš„æ–‡ç« ç²˜è´´åˆ°ä¸‹æ–¹','åœ¨è¿™é‡Œç²˜è´´ä½ å·²å†™å¥½çš„å®Œæ•´æ–‡ç« ...'],
    B:['è¾“å…¥ä½ çš„ä¸»é¢˜ã€æƒ³æ³•æˆ–çµæ„Ÿ','åœ¨è¿™é‡Œè¾“å…¥ä½ æƒ³å†™çš„ä¸»é¢˜æˆ–æƒ³æ³•...\n\nä¾‹å¦‚ï¼š\n- ä¸ºä»€ä¹ˆè¶ŠåŠªåŠ›è¶Šç„¦è™‘ï¼Ÿ\n- å¦‚ä½•åœ¨ä¿¡æ¯è¿‡è½½æ—¶ä»£ä¿æŒä¸“æ³¨'],
    C:['ç²˜è´´ä½ çš„é•¿ç´ æï¼ˆé€å­—ç¨¿ã€ç¬”è®°ç­‰ï¼‰','åœ¨è¿™é‡Œç²˜è´´ä½ çš„é•¿ç´ æï¼Œå¦‚è¯¾ç¨‹é€å­—ç¨¿ã€æ’­å®¢æ–‡å­—ç¨¿ã€ä¼šè®®è®°å½•ç­‰...'],
    D:['ç²˜è´´ä½ æ”¶é›†çš„å¤šä¸ªç´ æç‰‡æ®µ','åœ¨è¿™é‡Œç²˜è´´ä½ æ”¶é›†çš„ç´ æç‰‡æ®µ...\n\nç”¨ ===ç´ æåˆ†éš”=== åˆ†éš”ä¸åŒçš„ç´ æ']
  };
  desc.textContent=placeholders[currentMode][0];
  input.placeholder=placeholders[currentMode][1];
}

function updateMaterialWordCount(){
  const text=document.getElementById('userMaterialInput').value;
  document.getElementById('materialWordCount').textContent=text.replace(/\s/g,'').length+' å­—';
}

function saveMaterialInput(){
  const text=document.getElementById('userMaterialInput').value.trim();
  if(!text){showToast('âš ï¸ è¯·å…ˆå¡«å†™å†…å®¹å†ä¿å­˜');return}
  updateMaterialWordCount();
  generatePrompt();
  showToast('âœ… å·²ä¿å­˜å¹¶åŒæ­¥æç¤ºè¯');
}

function clearMaterialInput(){
  document.getElementById('userMaterialInput').value='';
  updateMaterialWordCount();
  generatePrompt();
}

function generatePrompt(){
  const userMaterial=document.getElementById('userMaterialInput')?.value?.trim()||'';
  const materialPlaceholders={
    A:'[æŠŠä½ çš„æ–‡ç« ç²˜è´´åœ¨è¿™é‡Œ]',
    B:'[åœ¨è¿™é‡Œè¾“å…¥ä½ çš„ä¸»é¢˜æˆ–æƒ³æ³•]',
    C:'[æŠŠä½ çš„é€å­—ç¨¿/ç¬”è®°ç²˜è´´åœ¨è¿™é‡Œ]',
    D:'[æŠŠä½ æ”¶é›†çš„å„ç§ç´ æç²˜è´´åœ¨è¿™é‡Œï¼Œç”¨ --- åˆ†éš”ä¸åŒç´ æ]'
  };
  let prompt='';
  const styleDesc=currentStyleTab==='custom'?document.getElementById('customStyleInput')?.value||'ä¸“ä¸šä½†æ˜“è¯»':styleDescriptions[currentStyle]||'';
  const lenReq=currentLength==='auto'?'æ ¹æ®ä¸»é¢˜å¤æ‚åº¦è‡ªåŠ¨å†³å®šé•¿åº¦':currentLength==='short'?'800-1200å­—':currentLength==='long'?'3000-4000å­—':'1500-2500å­—';
  const lenLimit=currentLength==='auto'?'æœ€ç»ˆå­—æ•°æ ¹æ®ä¸»é¢˜å¤æ‚åº¦è‡ªåŠ¨å†³å®š':`æœ€ç»ˆå­—æ•°æ§åˆ¶åœ¨${lenReq}`;
  const lenFinal=currentLength==='auto'?'æœ€ç»ˆå­—æ•°æ ¹æ®ä¸»é¢˜å¤æ‚åº¦è‡ªåŠ¨å†³å®š':`æœ€ç»ˆå­—æ•°${lenReq}`;

  if(currentMode==='A'){
    prompt=`ä½ æ˜¯ä¸€ä½èµ„æ·±å…¬ä¼—å·æ’ç‰ˆç¼–è¾‘ï¼Œè¯·å¸®æˆ‘ä¼˜åŒ–æ–‡ç« çš„æ’ç‰ˆæ ¼å¼ã€‚

## ä½ éœ€è¦åšçš„äº‹

1. **æç‚¼é‡‘å¥**ï¼ˆæ¯ç¯‡3-5å¥ï¼‰
   - ç”¨ \`>\` æ ‡è®°
   - å¥½é‡‘å¥çš„æ ‡å‡†ï¼šæœ‰æ´å¯Ÿã€åå¸¸è¯†ã€èƒ½å¼•å‘å…±é¸£ã€è®©äººæƒ³æˆªå›¾åˆ†äº«
   - é‡‘å¥å¯é•¿å¯çŸ­ï¼Œå…³é”®æ˜¯è¦æœ‰åŠ›é‡ï¼Œä¸è¦ä¸ºäº†çŸ­è€Œä¸¢å¤±æ„ä¹‰
   - ç¤ºä¾‹ï¼š> æˆ‘ä»¬ç„¦è™‘çš„ä¸æ˜¯æœªæ¥ï¼Œè€Œæ˜¯å¯¹æœªæ¥çš„æƒ³è±¡ã€‚

2. **æ ‡è®°å¼ºè°ƒ**
   - ç”¨ \`**æ–‡å­—**\` æ ‡è®°å…³é”®æ¦‚å¿µã€é‡è¦æœ¯è¯­
   - æ¯æ®µæœ€å¤š1-2å¤„ï¼Œä¸è¦è¿‡åº¦å¼ºè°ƒ

3. **æ·»åŠ å°æ ‡é¢˜**
   - ç”¨ \`## æ ‡é¢˜\` æ ‡è®°
   - åˆ’åˆ†æ–‡ç« çš„å¤§ç»“æ„ï¼Œé€šå¸¸3-5ä¸ª

4. **æ’å…¥åˆ†å‰²çº¿**
   - ç”¨ \`---\` æ ‡è®°
   - æ”¾åœ¨ä¸»é¢˜è½¬æ¢å¤„ï¼Œæ¯ç¯‡2-4å¤„

5. **å¤„ç†åˆ—è¡¨**
   - ç”¨ \`- åˆ—è¡¨é¡¹\` æ ‡è®°
   - 3ä¸ªä»¥ä¸Šå¹¶åˆ—é¡¹æ—¶ä½¿ç”¨

6. **å»ºè®®é…å›¾ä½ç½®**
   - ç”¨ \`![å›¾ç‰‡](å»ºè®®ï¼šæè¿°)\` æ ‡è®°
   - æ¯600-800å­—å»ºè®®ä¸€å¼ 
   - æ”¾åœ¨ä¸»é¢˜è½¬æ¢æˆ–æƒ…æ„Ÿé«˜æ½®å¤„
   - æè¿°è¦å…·ä½“ï¼Œä¾¿äºé…å›¾
   - ç¤ºä¾‹ï¼š![å›¾ç‰‡](å»ºè®®ï¼šä¸€ä¸ªäººåœ¨çª—è¾¹çœ‹é›¨ï¼Œå®‰é™æ€è€ƒçš„ç”»é¢)

## æ ¼å¼è§„åˆ™ï¼ˆéå¸¸é‡è¦ï¼‰

- é‡‘å¥ï¼ˆ>ï¼‰åé¢ä¸èƒ½ç´§è·Ÿå¦ä¸€ä¸ªé‡‘å¥ï¼Œä¸­é—´è¦æœ‰æ­£æ–‡
- æ ‡é¢˜ï¼ˆ##ï¼‰åé¢ä¸èƒ½ç´§è·Ÿå¦ä¸€ä¸ªæ ‡é¢˜
- ä¿ç•™åŸæ–‡æ‰€æœ‰æ ¸å¿ƒä¿¡æ¯
- é•¿æ®µè½æ‹†æˆçŸ­æ®µè½ï¼ˆæ¯æ®µ3-5å¥ï¼‰

## æˆ‘çš„æ–‡ç« 

[æŠŠä½ çš„æ–‡ç« ç²˜è´´åœ¨è¿™é‡Œ]

---
è¯·ç›´æ¥è¾“å‡ºå¤„ç†åçš„æ–‡ç« ï¼Œä¸è¦è§£é‡Šã€‚`;
  }
  else if(currentMode==='B'){
    prompt=`ä½ æ˜¯ä¸€ä½èµ„æ·±å…¬ä¼—å·çˆ†æ¬¾å†™æ‰‹ï¼Œè¯·æ ¹æ®æˆ‘ç»™çš„ä¸»é¢˜åˆ›ä½œä¸€ç¯‡é«˜è´¨é‡æ–‡ç« ã€‚

## æ–‡ç« é£æ ¼
${styleDesc}

## æ–‡ç« è¦æ±‚
1. å­—æ•°ï¼š${lenReq}
2. å¼€å¤´3ç§’æŠ“ä½è¯»è€…ï¼ˆç”¨æ•…äº‹ã€é—®é¢˜ã€åå¸¸è¯†è§‚ç‚¹ç­‰ï¼‰
3. æ¯300-400å­—è¦æœ‰ä¸€ä¸ªã€Œçˆ½ç‚¹ã€æˆ–ã€Œå…±é¸£ç‚¹ã€
4. é‡‘å¥è¦æœ‰æ´å¯ŸåŠ›ï¼Œè®©äººæƒ³æˆªå›¾åˆ†äº«
5. ç»“å°¾è¦æœ‰è¡ŒåŠ¨å·å¬æˆ–æƒ…æ„Ÿå‡å

## è¾“å‡ºæ ¼å¼ï¼ˆå¿…é¡»ä¸¥æ ¼éµå®ˆï¼‰

ç”¨ä»¥ä¸‹Markdownæ ¼å¼è¾“å‡ºï¼š

- \`> é‡‘å¥\` â€” æœ‰æ´å¯Ÿã€æœ‰åŠ›é‡çš„å¥å­ï¼Œæ¯ç¯‡4-6å¥
- \`**å¼ºè°ƒ**\` â€” å…³é”®è¯å¼ºè°ƒ
- \`## å°æ ‡é¢˜\` â€” åˆ’åˆ†ç»“æ„ï¼Œ3-5ä¸ª
- \`---\` â€” åˆ†å‰²çº¿ï¼Œæ”¾åœ¨ä¸»é¢˜è½¬æ¢å¤„
- \`- åˆ—è¡¨é¡¹\` â€” å¹¶åˆ—å†…å®¹
- \`![å›¾ç‰‡](å»ºè®®ï¼šå…·ä½“æè¿°)\` â€” é…å›¾å»ºè®®ï¼Œæ¯600å­—ä¸€å¼ 

## æ ¼å¼è§„åˆ™ï¼ˆéå¸¸é‡è¦ï¼‰
- é‡‘å¥ï¼ˆ>ï¼‰ä¹‹é—´ä¸èƒ½è¿ç»­ï¼Œä¸­é—´å¿…é¡»æœ‰æ­£æ–‡æ®µè½
- æ ‡é¢˜ï¼ˆ##ï¼‰ä¹‹é—´ä¸èƒ½è¿ç»­
- å›¾ç‰‡å»ºè®®è¦æœ‰å…·ä½“æè¿°ï¼Œæ¯”å¦‚ã€Œå»ºè®®ï¼šä¸€ä¸ªå¹´è½»äººåœ¨å’–å•¡é¦†ä¸“æ³¨å·¥ä½œã€

## æˆ‘çš„ä¸»é¢˜

[åœ¨è¿™é‡Œè¾“å…¥ä½ çš„ä¸»é¢˜æˆ–æƒ³æ³•]

---
è¯·ç›´æ¥è¾“å‡ºå®Œæ•´æ–‡ç« ï¼Œä¸è¦è§£é‡Šã€‚`;
  }
  else if(currentMode==='C'){
    prompt=`ä½ æ˜¯ä¸€ä½èµ„æ·±å†…å®¹ç¼–è¾‘ï¼Œè¯·ä»æˆ‘çš„é•¿ç´ æä¸­æç‚¼å‡ºä¸€ç¯‡ç²¾åæ–‡ç« ã€‚

## æ–‡ç« é£æ ¼
${styleDesc}

## æç‚¼åŸåˆ™
1. æ‰¾å‡ºç´ æä¸­æœ€æœ‰ä»·å€¼çš„3-5ä¸ªæ ¸å¿ƒè§‚ç‚¹
2. åˆ é™¤é‡å¤ã€è·‘é¢˜ã€å£è¯­åŒ–çš„éƒ¨åˆ†
3. é‡æ–°ç»„ç»‡ç»“æ„ï¼Œè®©é€»è¾‘æ›´æ¸…æ™°
4. ä¿ç•™ç²¾å½©çš„æ¡ˆä¾‹å’Œé‡‘å¥
5. ${lenLimit}

## è¾“å‡ºæ ¼å¼ï¼ˆå¿…é¡»ä¸¥æ ¼éµå®ˆï¼‰

ç”¨ä»¥ä¸‹Markdownæ ¼å¼è¾“å‡ºï¼š

- \`> é‡‘å¥\` â€” ä»åŸæ–‡æç‚¼æˆ–æ”¹å†™ï¼Œè¦æœ‰æ´å¯ŸåŠ›
- \`**å¼ºè°ƒ**\` â€” å…³é”®æ¦‚å¿µ
- \`## å°æ ‡é¢˜\` â€” åˆ’åˆ†ç»“æ„
- \`---\` â€” åˆ†å‰²çº¿
- \`- åˆ—è¡¨é¡¹\` â€” å¹¶åˆ—å†…å®¹
- \`![å›¾ç‰‡](å»ºè®®ï¼šå…·ä½“æè¿°)\` â€” é…å›¾å»ºè®®ï¼Œæ¯600å­—ä¸€å¼ 

## æ ¼å¼è§„åˆ™ï¼ˆéå¸¸é‡è¦ï¼‰
- é‡‘å¥ï¼ˆ>ï¼‰ä¹‹é—´ä¸èƒ½è¿ç»­ï¼Œä¸­é—´å¿…é¡»æœ‰æ­£æ–‡æ®µè½
- æ ‡é¢˜ï¼ˆ##ï¼‰ä¹‹é—´ä¸èƒ½è¿ç»­
- å›¾ç‰‡å»ºè®®è¦å†™æ¸…æ¥šå…·ä½“åœºæ™¯

## æˆ‘çš„åŸå§‹ç´ æ

[æŠŠä½ çš„é€å­—ç¨¿/ç¬”è®°ç²˜è´´åœ¨è¿™é‡Œ]

---
è¯·ç›´æ¥è¾“å‡ºæç‚¼åçš„æ–‡ç« ï¼Œä¸è¦è§£é‡Šã€‚`;
  }
  else{
    prompt=`ä½ æ˜¯ä¸€ä½èµ„æ·±å†…å®¹åˆ›ä½œè€…ï¼Œè¯·å¸®æˆ‘æŠŠå¤šä¸ªç´ ææ•´åˆæˆä¸€ç¯‡åŸåˆ›æ–‡ç« ã€‚

## æ–‡ç« é£æ ¼
${styleDesc}

## æ•´åˆåŸåˆ™ï¼ˆé¿å…æŠ„è¢­ï¼‰
1. ç†è§£æ¯ä¸ªç´ æçš„ã€æ ¸å¿ƒè§‚ç‚¹ã€‘ï¼Œè€Œéç…§æ¬è¡¨è¾¾
2. ç”¨ã€å…¨æ–°çš„è¯­è¨€ã€‘é‡æ–°é˜è¿°
3. èå…¥æˆ‘è‡ªå·±çš„è§†è§’è¿›è¡Œè¯„è®ºå’Œå»¶ä¼¸
4. é‡æ–°è®¾è®¡æ–‡ç« ç»“æ„
5. ${lenFinal}

## è¾“å‡ºæ ¼å¼ï¼ˆå¿…é¡»ä¸¥æ ¼éµå®ˆï¼‰

ç”¨ä»¥ä¸‹Markdownæ ¼å¼è¾“å‡ºï¼š

- \`> é‡‘å¥\` â€” å¿…é¡»æ˜¯åŸåˆ›è¡¨è¾¾ï¼Œæœ‰æ´å¯ŸåŠ›
- \`**å¼ºè°ƒ**\` â€” å…³é”®æ¦‚å¿µ
- \`## å°æ ‡é¢˜\` â€” åˆ’åˆ†ç»“æ„
- \`---\` â€” åˆ†å‰²çº¿
- \`- åˆ—è¡¨é¡¹\` â€” å¹¶åˆ—å†…å®¹
- \`![å›¾ç‰‡](å»ºè®®ï¼šå…·ä½“æè¿°)\` â€” é…å›¾å»ºè®®ï¼Œæ¯600å­—ä¸€å¼ 

## æ ¼å¼è§„åˆ™ï¼ˆéå¸¸é‡è¦ï¼‰
- é‡‘å¥ï¼ˆ>ï¼‰ä¹‹é—´ä¸èƒ½è¿ç»­ï¼Œä¸­é—´å¿…é¡»æœ‰æ­£æ–‡æ®µè½
- æ ‡é¢˜ï¼ˆ##ï¼‰ä¹‹é—´ä¸èƒ½è¿ç»­

## æˆ‘çš„ç´ æç‰‡æ®µ

[æŠŠä½ æ”¶é›†çš„å„ç§ç´ æç²˜è´´åœ¨è¿™é‡Œï¼Œç”¨ --- åˆ†éš”ä¸åŒç´ æ]

## æˆ‘çš„è§†è§’/æƒ³å¼ºè°ƒçš„è§‚ç‚¹ï¼ˆå¯é€‰ï¼‰

[å¦‚æœæœ‰ä½ è‡ªå·±çš„è§‚ç‚¹æƒ³èå…¥ï¼Œå†™åœ¨è¿™é‡Œ]

---
è¯·ç›´æ¥è¾“å‡ºåŸåˆ›æ–‡ç« ï¼Œä¸è¦è§£é‡Šã€‚`;
  }

  if(userMaterial){
    const placeholder=materialPlaceholders[currentMode];
    if(placeholder&&prompt.includes(placeholder)){prompt=prompt.replace(placeholder,userMaterial)}
  }

  document.getElementById('promptText').textContent=prompt;
}

function copyPrompt(){navigator.clipboard.writeText(document.getElementById('promptText').textContent).then(()=>showToast('âœ… æç¤ºè¯å·²å¤åˆ¶'))}
function copyAndJump(url){navigator.clipboard.writeText(document.getElementById('promptText').textContent).then(()=>{showToast('âœ… å·²å¤åˆ¶ï¼Œæ­£åœ¨è·³è½¬...');setTimeout(()=>window.open(url,'_blank'),300)})}

function updateWordCount(){const text=document.getElementById('inputText').value;document.getElementById('wordCount').textContent=text.replace(/\s/g,'').length+' å­—'}

function parseContent(){
  const text=document.getElementById('inputText').value.trim();
  if(!text){showToast('âš ï¸ è¯·å…ˆç²˜è´´å†…å®¹');return}

  // æå–é…å›¾æç¤ºè¯
  const imgPromptMatch=text.match(/===é…å›¾æç¤ºè¯===([\s\S]*?)$/);
  if(imgPromptMatch){
    const imgSection=imgPromptMatch[1];
    imagePrompts={
      cover:(imgSection.match(/ã€å…¬ä¼—å·å°é¢å›¾ã€‘\s*([\s\S]*?)(?=ã€|$)/)||[])[1]?.trim()||'',
      xhsCover:(imgSection.match(/ã€å°çº¢ä¹¦å°é¢å›¾ã€‘\s*([\s\S]*?)(?=ã€|$)/)||[])[1]?.trim()||'',
      social:(imgSection.match(/ã€æœ‹å‹åœˆé…å›¾ã€‘\s*([\s\S]*?)(?=ã€|$)/)||[])[1]?.trim()||'',
      quoteCard:(imgSection.match(/ã€é‡‘å¥å¡ç‰‡èƒŒæ™¯ã€‘\s*([\s\S]*?)(?=ã€|$)/)||[])[1]?.trim()||''
    };
    document.getElementById('coverImagePrompt').textContent=imagePrompts.cover||'æœªæ‰¾åˆ°';
    document.getElementById('xhsCoverImagePrompt').textContent=imagePrompts.xhsCover||'æœªæ‰¾åˆ°';
    document.getElementById('socialImagePrompt').textContent=imagePrompts.social||'æœªæ‰¾åˆ°';
    document.getElementById('quoteCardImagePrompt').textContent=imagePrompts.quoteCard||'æœªæ‰¾åˆ°';
  }

  // æå–æ­£æ–‡éƒ¨åˆ†
  let articleText=text.replace(/===é…å›¾æç¤ºè¯===[\s\S]*$/,'').trim();

  blocks=[];
  const lines=articleText.split('\n');
  let i=0;
  while(i<lines.length){
    const line=lines[i].trim();
    if(!line){i++;continue}
    
    if(line==='---'||line==='***'||line==='___'){blocks.push({type:'divider',content:''});i++;continue}
    if(line.startsWith('## ')){blocks.push({type:'heading',content:line.slice(3)});i++;continue}
    if(line.startsWith('> ')){blocks.push({type:'quote',content:line.slice(2)});i++;continue}
    
    const imgMatch=line.match(/^!\[([^\]]*)\]\(([^)]+)\)/);
    if(imgMatch){
      const desc=imgMatch[1]||imgMatch[2];
      const src=imgMatch[2];
      if(src.startsWith('http')||src.startsWith('data:')){
        blocks.push({type:'image',content:src});
      }else{
        // ä¸ºé…å›¾å»ºè®®ç”Ÿæˆè‹±æ–‡æç¤ºè¯
        const imgPrompt=generateImagePromptFromDesc(desc);
        blocks.push({type:'imagePlaceholder',content:desc,imgPrompt:imgPrompt});
      }
      i++;continue;
    }
    
    if(line.startsWith('- ')||line.startsWith('* ')){
      let listItems=[line.slice(2)];
      while(i+1<lines.length&&(lines[i+1].trim().startsWith('- ')||lines[i+1].trim().startsWith('* '))){i++;listItems.push(lines[i].trim().slice(2))}
      blocks.push({type:'list',content:listItems.join('\n')});i++;continue
    }
    
    blocks.push({type:'paragraph',content:line});i++;
  }

  document.getElementById('inputCard').style.display='none';
  document.getElementById('editorSection').style.display='grid';
  renderBlocks();
  updateFullArticleText();
  updatePreview();
  showToast('âœ… è§£æå®Œæˆï¼Œå…±'+blocks.length+'ä¸ªæ¨¡å—');
}

// æ ¹æ®ä¸­æ–‡æè¿°ç”Ÿæˆè‹±æ–‡å›¾ç‰‡æç¤ºè¯
function generateImagePromptFromDesc(desc){
  // åŸºç¡€é£æ ¼
  const baseStyle='soft lighting, editorial photography style, high quality, 4k';
  // ç®€å•ç¿»è¯‘å¸¸è§è¯æ±‡
  const translations={
    'èƒŒå½±':'back view, silhouette',
    'åå­—è·¯å£':'crossroads, intersection',
    'çŠ¹è±«':'hesitant, contemplative',
    'é˜³å…‰':'sunlight, golden hour',
    'æ¸©æš–':'warm, cozy',
    'å­¤ç‹¬':'solitary, alone',
    'è‡ªç”±':'freedom, free spirit',
    'æ€è€ƒ':'thinking, contemplative',
    'æˆé•¿':'growth, personal development',
    'å¸Œæœ›':'hope, hopeful',
    'å¤œæ™š':'night, evening',
    'åŸå¸‚':'city, urban',
    'è‡ªç„¶':'nature, natural',
    'ä¹¦ç±':'books, reading',
    'å’–å•¡':'coffee, cafe'
  };
  
  let englishDesc=desc;
  for(const[cn,en] of Object.entries(translations)){
    if(desc.includes(cn)){
      englishDesc=en+', '+englishDesc.replace(cn,'');
    }
  }
  
  return `${englishDesc}, ${baseStyle} --ar 16:9`;
}

function showInputCard(){document.getElementById('inputCard').style.display='block';document.getElementById('editorSection').style.display='none'}

function updateFullArticleText(){
  const fullText=blocks.map(b=>{
    switch(b.type){
      case'heading':return '## '+b.content;
      case'quote':return '> '+b.content;
      case'divider':return '---';
      case'list':return b.content.split('\n').map(item=>'- '+item).join('\n');
      case'imagePlaceholder':return '![é…å›¾]('+b.content+')';
      case'image':return '![å›¾ç‰‡]('+b.content+')';
      case'emphasis':return '**'+b.content+'**';
      default:return b.content;
    }
  }).join('\n\n');
  document.getElementById('fullArticleText').value=fullText;
}

function onFullArticleInput(){clearTimeout(fullArticleSyncTimeout);fullArticleSyncTimeout=setTimeout(syncFromFullArticle,1000)}

function syncFromFullArticle(){
  const text=document.getElementById('fullArticleText').value;
  document.getElementById('inputText').value=text;
  parseContentSilent(text);
}

function parseContentSilent(text){
  let articleText=text.replace(/===é…å›¾æç¤ºè¯===[\s\S]*$/,'').trim();
  blocks=[];
  const lines=articleText.split('\n');
  let i=0;
  while(i<lines.length){
    const line=lines[i].trim();
    if(!line){i++;continue}
    if(line==='---'||line==='***'||line==='___'){blocks.push({type:'divider',content:''});i++;continue}
    if(line.startsWith('## ')){blocks.push({type:'heading',content:line.slice(3)});i++;continue}
    if(line.startsWith('> ')){blocks.push({type:'quote',content:line.slice(2)});i++;continue}
    const imgMatch=line.match(/^!\[([^\]]*)\]\(([^)]+)\)/);
    if(imgMatch){
      const desc=imgMatch[1]||imgMatch[2];
      const src=imgMatch[2];
      if(src.startsWith('http')||src.startsWith('data:')){
        blocks.push({type:'image',content:src});
      }else{
        const imgPrompt=generateImagePromptFromDesc(desc);
        blocks.push({type:'imagePlaceholder',content:desc,imgPrompt:imgPrompt});
      }
      i++;continue;
    }
    if(line.startsWith('- ')||line.startsWith('* ')){
      let listItems=[line.slice(2)];
      while(i+1<lines.length&&(lines[i+1].trim().startsWith('- ')||lines[i+1].trim().startsWith('* '))){i++;listItems.push(lines[i].trim().slice(2))}
      blocks.push({type:'list',content:listItems.join('\n')});i++;continue
    }
    blocks.push({type:'paragraph',content:line});i++;
  }
  renderBlocks();
  updatePreview();
}

function renderBlocks(){
  const container=document.getElementById('blocksList');
  if(!blocks.length){container.innerHTML='<div style="text-align:center;color:#999;padding:40px">æš‚æ— å†…å®¹</div>';document.getElementById('blockCount').textContent='(0)';return}
  
  container.innerHTML=blocks.map((b,i)=>{
    const typeOpts=Object.entries(blockTypeNames).map(([v,l])=>'<option value="'+v+'"'+(b.type===v?' selected':'')+'>'+l+'</option>').join('');
    let content='';
    
    if(b.type==='divider'){
      content='<div class="divider-preview">Â· Â· Â·</div>';
    }else if(b.type==='image'){
      content='<input type="text" class="block-input" value="'+(b.content||'')+'" onchange="updateBlock('+i+', this.value)" onblur="updateAll()">';
    }else if(b.type==='imagePlaceholder'){
      // æ˜¾ç¤ºé…å›¾å»ºè®®å’Œç”Ÿæˆæç¤ºè¯
      content=`<div class="img-placeholder">
        <div class="img-placeholder-text">ğŸ“· ${b.content}</div>
        ${b.imgPrompt?'<div class="img-placeholder-prompt">ğŸ’¡ ç”Ÿæˆæç¤ºè¯ï¼š'+b.imgPrompt+'</div>':''}
        <div class="img-placeholder-actions">
          ${b.imgPrompt?'<button class="btn btn-secondary btn-sm" onclick="copyImgPrompt('+i+')">å¤åˆ¶æç¤ºè¯</button>':''}
          <button class="btn btn-secondary btn-sm" onclick="openImageModalFor('+i+')">ä¸Šä¼ å›¾ç‰‡</button>
        </div>
      </div>`;
    }else{
      content='<textarea class="block-input" onchange="updateBlock('+i+', this.value)" onblur="updateAll()">'+(b.content||'')+'</textarea>';
    }
    
    return `<div class="block-item">
      <div class="block-head">
        <select class="block-type-sel" onchange="changeBlockType(${i}, this.value)">${typeOpts}</select>
        <div class="block-actions">
          <button class="block-act-btn" onclick="moveBlock(${i}, -1)">â†‘</button>
          <button class="block-act-btn" onclick="moveBlock(${i}, 1)">â†“</button>
          <button class="block-act-btn img" onclick="insertImageAfter(${i})" title="æ’å…¥å›¾ç‰‡">ğŸ–¼</button>
          <button class="block-act-btn del" onclick="deleteBlock(${i})">Ã—</button>
        </div>
      </div>
      <div class="block-body">${content}</div>
    </div>`;
  }).join('');
  
  document.getElementById('blockCount').textContent='('+blocks.length+')';
}

function copyImgPrompt(i){
  const prompt=blocks[i]?.imgPrompt||'';
  if(prompt){
    navigator.clipboard.writeText(prompt).then(()=>showToast('âœ… æç¤ºè¯å·²å¤åˆ¶'));
  }
}

function insertImageAfter(i){
  editingImageIndex=i+1;
  document.getElementById('imageUrlInput').value='';
  document.getElementById('imageModal').classList.add('show');
}

function updateBlock(i,v){blocks[i].content=v}
function updateAll(){updatePreview();updateFullArticleText()}
function changeBlockType(i,t){blocks[i].type=t;renderBlocks();updateAll()}
function moveBlock(i,dir){const j=i+dir;if(j<0||j>=blocks.length)return;[blocks[i],blocks[j]]=[blocks[j],blocks[i]];renderBlocks();updateAll()}
function deleteBlock(i){blocks.splice(i,1);renderBlocks();updateAll()}
function addBlock(type){blocks.push({type,content:'',imgPrompt:''});renderBlocks();updateAll()}
function openImageModalFor(i){editingImageIndex=i;document.getElementById('imageUrlInput').value='';document.getElementById('imageModal').classList.add('show')}
function closeImageModal(){document.getElementById('imageModal').classList.remove('show');editingImageIndex=null}

function confirmImage(){
  const url=document.getElementById('imageUrlInput').value.trim();
  if(editingImageIndex!==null&&url){
    if(blocks[editingImageIndex]?.type==='imagePlaceholder'||blocks[editingImageIndex]?.type==='image'){
      blocks[editingImageIndex]={type:'image',content:url};
    }else{
      blocks.splice(editingImageIndex,0,{type:'image',content:url});
    }
    renderBlocks();updateAll();closeImageModal();showToast('âœ… å›¾ç‰‡å·²æ·»åŠ ');
  }
}

function handleImageUpload(e){const file=e.target.files[0];if(file){const reader=new FileReader();reader.onload=ev=>{document.getElementById('imageUrlInput').value=ev.target.result};reader.readAsDataURL(file)}}

function updatePreview(){
  const container=document.getElementById('previewContent');
  if(!blocks.length){container.innerHTML='<div style="text-align:center;color:#999;padding:40px">é¢„è§ˆå†…å®¹</div>';return}
  container.innerHTML=blocks.map(b=>generateBlockHTML(b)).join('');
}

function generateBlockHTML(block){
  const s=schemes[currentScheme];
  switch(block.type){
    case'paragraph':
      let p=(block.content||'').replace(/\*\*([^*]+)\*\*/g,'<strong style="color:'+s.primary+';">$1</strong>').replace(/\n/g,'<br>');
      return '<p style="font-size:15px;color:'+s.text+';line-height:2;margin-bottom:20px;">'+p+'</p>';
    case'emphasis':
      return '<p style="font-size:15px;color:'+s.text+';line-height:2;margin-bottom:20px;"><strong style="color:'+s.primary+';">'+(block.content||'')+'</strong></p>';
    case'heading':
      return '<p style="font-size:17px;color:'+s.primary+';font-weight:600;margin:28px 0 16px;">'+(block.content||'')+'</p>';
    case'divider':
      return '<p style="text-align:center;color:'+s.border+';margin:28px 0;letter-spacing:8px;">Â·Â·Â·</p>';
    case'quote':
      const len=(block.content||'').length;
      if(len<=40)return '<p style="font-size:17px;color:'+s.primary+';line-height:1.8;margin:28px 0;text-align:center;font-weight:600;">'+block.content+'</p>';
      return '<section style="background:linear-gradient(135deg,'+s.bgWarm+','+s.bgWarmEnd+');border-left:3px solid '+s.primary+';padding:18px 20px;margin:24px 0;border-radius:0 10px 10px 0;"><p style="font-size:15px;color:'+s.primary+';line-height:1.9;margin:0;font-weight:500;">'+(block.content||'').replace(/\n/g,'<br>')+'</p></section>';
    case'list':
      const items=(block.content||'').split('\n').filter(x=>x.trim());
      return '<section style="background:'+s.bgCard+';padding:18px 20px;margin:24px 0;border-radius:10px;border:1px solid '+s.border+';">'+items.map(item=>'<p style="font-size:14px;color:'+s.textLight+';line-height:2;margin-bottom:8px;padding-left:16px;position:relative;"><span style="position:absolute;left:0;color:'+s.primary+';">â†’</span>'+item+'</p>').join('')+'</section>';
    case'image':
      return block.content?'<p style="text-align:center;margin:24px 0;"><img src="'+block.content+'" style="max-width:100%;border-radius:10px;"></p>':'';
    case'imagePlaceholder':
      return '<p style="text-align:center;margin:24px 0;padding:28px;background:#fafafa;border-radius:10px;color:#999;font-size:13px;border:1px dashed #ddd;">ğŸ“· '+(block.content||'å»ºè®®æ’å…¥å›¾ç‰‡')+'</p>';
    default:
      return '';
  }
}

function generateFullCode(){return blocks.filter(b=>b.type!=='imagePlaceholder').map(b=>generateBlockHTML(b)).join('')}
function copyAllCode(){const code=generateFullCode();if(!code){showToast('âš ï¸ æ— å†…å®¹');return}navigator.clipboard.writeText(code).then(()=>showToast('âœ… ä»£ç å·²å¤åˆ¶'))}

function generateMaterials(){
  const articleSummary=blocks.filter(b=>['paragraph','quote','heading'].includes(b.type)).map(b=>b.content).join('\n').substring(0,2000);
  if(!articleSummary.trim()){showToast('âš ï¸ è¯·å…ˆåœ¨æ­¥éª¤3å®Œæˆæ–‡ç« æ’ç‰ˆ');return}

  const prompt=`ä½ æ˜¯ä¸€ä½èµ„æ·±æ–°åª’ä½“è¿è¥ä¸“å®¶ï¼Œè¯·æ ¹æ®ä»¥ä¸‹å…¬ä¼—å·æ–‡ç« å†…å®¹ï¼Œç”Ÿæˆå…¨å¥—è¥é”€ç‰©æ–™ã€‚

## æ–‡ç« å†…å®¹
${articleSummary}

## è¯·ç”Ÿæˆä»¥ä¸‹12ç§ç‰©æ–™

ã€æœ‹å‹åœˆï¼ˆä½œè€…ç‰ˆï¼‰ã€‘
è¦æ±‚ï¼šç¬¬ä¸€äººç§°ï¼Œæœ‰ä¸ªäººæ„Ÿæ‚Ÿï¼Œå¼•å‘å¥½å¥‡ï¼Œ150å­—ä»¥å†…ï¼Œå¸¦emoji

ã€æœ‹å‹åœˆï¼ˆè½¬å‘ç‰ˆï¼‰ã€‘
è¦æ±‚ï¼šç¬¬ä¸‰äººç§°æ¨èï¼Œçªå‡ºæ–‡ç« ä»·å€¼ï¼Œå¼•å¯¼ç‚¹å‡»ï¼Œ150å­—ä»¥å†…

ã€å°çº¢ä¹¦æ–‡æ¡ˆã€‘
è¦æ±‚ï¼šå£è¯­åŒ–ã€æœ‰ç½‘æ„Ÿã€å¸¦è¯é¢˜æ ‡ç­¾ã€åˆ†æ®µæ¸…æ™°ã€300å­—å·¦å³

ã€å°çº¢ä¹¦æ ‡é¢˜ã€‘
è¦æ±‚ï¼š5ä¸ªå¤‡é€‰ï¼Œæœ‰æ•°å­—ã€æœ‰æƒ…ç»ªè¯ã€æœ‰ç—›ç‚¹ã€æ§åˆ¶åœ¨20å­—å†…

ã€ç¤¾ç¾¤è½¬å‘è¯æœ¯ã€‘
è¦æ±‚ï¼šé€‚åˆå¾®ä¿¡ç¾¤åˆ†äº«ï¼Œç®€æ´æœ‰åŠ›ï¼Œ100å­—ä»¥å†…

ã€ç§èŠæ¨èè¯æœ¯ã€‘
è¦æ±‚ï¼šåƒæœ‹å‹æ¨èï¼Œè‡ªç„¶ä¸è¥é”€ï¼Œ80å­—ä»¥å†…

ã€æ–‡ç« æ ‡é¢˜å¤‡é€‰ã€‘
è¦æ±‚ï¼š8ä¸ªä¸åŒé£æ ¼â€”â€”æ‚¬å¿µå‹ã€æ•°å­—å‹ã€ç—›ç‚¹å‹ã€å¥½å¥‡å‹ã€å…±é¸£å‹ç­‰

ã€ç›®æ ‡äººç¾¤ç”»åƒã€‘
è¦æ±‚ï¼š3-5ç±»æœ€é€‚åˆé˜…è¯»çš„äººç¾¤ï¼ŒåŒ…æ‹¬ç‰¹å¾å’Œç—›ç‚¹

ã€é‡‘å¥å¡ç‰‡æ–‡æ¡ˆã€‘
è¦æ±‚ï¼š5æ¡ï¼Œæ¯æ¡15-30å­—ï¼Œé€‚åˆåšæˆå›¾ç‰‡

ã€çŸ­è§†é¢‘å£æ’­æ–‡æ¡ˆã€‘
è¦æ±‚ï¼šå¼€å¤´æœ‰é’©å­ï¼Œ300å­—å·¦å³ï¼Œé€‚åˆ1åˆ†é’ŸçŸ­è§†é¢‘

ã€æ¬¡æ¡/è½¬è½½ç‰ˆã€‘
è¦æ±‚ï¼š100å­—ç®€ä»‹+æ ¸å¿ƒçœ‹ç‚¹

ã€SEOå…³é”®è¯ã€‘
è¦æ±‚ï¼š10-15ä¸ªæœç´¢å…³é”®è¯ï¼ŒåŒ…æ‹¬é•¿å°¾è¯

---
è¯·æŒ‰ä»¥ä¸Šæ ¼å¼è¾“å‡ºï¼Œæ¯ä¸ªç±»åˆ«ç”¨ã€ç±»åˆ«åã€‘æ ‡æ³¨ï¼Œå†…å®¹ç´§è·Ÿå…¶åã€‚`;

  document.getElementById('materialsPrompt').textContent=prompt;
  showToast('âœ… ç‰©æ–™æç¤ºè¯å·²ç”Ÿæˆ');
}

function copyMaterialsPrompt(){navigator.clipboard.writeText(document.getElementById('materialsPrompt').textContent).then(()=>showToast('âœ… å·²å¤åˆ¶'))}
function copyMaterialsAndJump(url){navigator.clipboard.writeText(document.getElementById('materialsPrompt').textContent).then(()=>{showToast('âœ… å·²å¤åˆ¶');setTimeout(()=>window.open(url,'_blank'),300)})}

function parseMaterials(){
  const text=document.getElementById('materialsInput').value.trim();
  if(!text){showToast('âš ï¸ è¯·å…ˆç²˜è´´ç‰©æ–™å†…å®¹');return}
  
  materials={};
  materialTypes.forEach(mt=>{
    const regex=new RegExp('ã€'+mt.name+'ã€‘\\s*([\\s\\S]*?)(?=ã€|$)');
    const match=text.match(regex);
    if(match)materials[mt.id]=match[1].trim();
  });
  
  renderMaterials();
  showToast('âœ… ç‰©æ–™è§£æå®Œæˆ');
}

function renderMaterials(){
  const grid=document.getElementById('materialsGrid');
  grid.innerHTML=materialTypes.map(mt=>{
    const content=materials[mt.id]||'';
    return `<div class="material-card">
      <div class="material-header">
        <div class="material-title">${mt.icon} ${mt.name}</div>
        <button class="btn btn-sm btn-outline" onclick="copyMaterial('${mt.id}')">å¤åˆ¶</button>
      </div>
      <div class="material-content">
        <textarea onchange="materials['${mt.id}']=this.value">${content}</textarea>
      </div>
    </div>`;
  }).join('');
}

function copyMaterial(id){
  const content=materials[id]||'';
  if(content){navigator.clipboard.writeText(content).then(()=>showToast('âœ… å·²å¤åˆ¶'))}else{showToast('âš ï¸ æ— å†…å®¹')}
}

function copyImagePrompt(type){
  const prompt=imagePrompts[type]||'';
  if(prompt){navigator.clipboard.writeText(prompt).then(()=>showToast('âœ… å·²å¤åˆ¶'))}else{showToast('âš ï¸ æ— å†…å®¹')}
}

function exportAll(){
  let content='# çŒ«é—¨æ™ºèƒ½æ’ç‰ˆå™¨å¯¼å‡º\n\n';
  content+='## æ’ç‰ˆåçš„æ–‡ç« ä»£ç \n\n```html\n'+generateFullCode()+'\n```\n\n';
  if(Object.keys(imagePrompts).length){
    content+='## é…å›¾æç¤ºè¯\n\n';
    if(imagePrompts.cover)content+='### å…¬ä¼—å·å°é¢å›¾\n'+imagePrompts.cover+'\n\n';
    if(imagePrompts.xhsCover)content+='### å°çº¢ä¹¦å°é¢å›¾\n'+imagePrompts.xhsCover+'\n\n';
    if(imagePrompts.social)content+='### æœ‹å‹åœˆé…å›¾\n'+imagePrompts.social+'\n\n';
    if(imagePrompts.quoteCard)content+='### é‡‘å¥å¡ç‰‡èƒŒæ™¯\n'+imagePrompts.quoteCard+'\n\n';
  }
  if(Object.keys(materials).length){
    content+='## è¥é”€ç‰©æ–™\n\n';
    materialTypes.forEach(mt=>{if(materials[mt.id])content+='### '+mt.name+'\n'+materials[mt.id]+'\n\n'});
  }
  navigator.clipboard.writeText(content).then(()=>showToast('âœ… å…¨éƒ¨å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿'));
}

// åˆå§‹åŒ–é…è‰²é€‰æ‹©
document.querySelectorAll('.color-btn').forEach(btn=>{
  btn.addEventListener('click',()=>{
    document.querySelectorAll('.color-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    currentScheme=btn.dataset.scheme;
    updatePreview();
  });
});

// ç‚¹å‡»é®ç½©å…³é—­æ¨¡æ€æ¡†
document.querySelectorAll('.modal-overlay').forEach(o=>{o.addEventListener('click',e=>{if(e.target===o)o.classList.remove('show')})});

generatePrompt();
</script>
</body>
</html>
